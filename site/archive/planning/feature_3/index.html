<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Advanced Bearing Fault Diagnosis System - Production-Ready Research Platform"><meta name=author content="Syed Abbas Ahmad"><link href=https://abbas-ahmad-cowlar.github.io/LSTM_PFD/archive/planning/feature_3/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>FEATURE #3: EMAIL NOTIFICATIONS - LSTM PFD Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#feature-3-email-notifications class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="LSTM PFD Documentation" class="md-header__button md-logo" aria-label="LSTM PFD Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m16 11.78 4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L5.46 19H22v2H2V3h2v14.54L9.5 8z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> LSTM PFD Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> FEATURE #3: EMAIL NOTIFICATIONS </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/abbas-ahmad-cowlar/LSTM_PFD title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> abbas-ahmad-cowlar/LSTM_PFD </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../user-guide/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../../api/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../../research/ class=md-tabs__link> Research </a> </li> <li class=md-tabs__item> <a href=../../../DEPLOYMENT_GUIDE/ class=md-tabs__link> Deployment </a> </li> <li class=md-tabs__item> <a href=../../../../CHANGELOG.md class=md-tabs__link> Changelog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="LSTM PFD Documentation" class="md-nav__button md-logo" aria-label="LSTM PFD Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m16 11.78 4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L5.46 19H22v2H2V3h2v14.54L9.5 8z"/></svg> </a> LSTM PFD Documentation </label> <div class=md-nav__source> <a href=https://github.com/abbas-ahmad-cowlar/LSTM_PFD title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> abbas-ahmad-cowlar/LSTM_PFD </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../../getting-started/first-experiment/ class=md-nav__link> <span class=md-ellipsis> First Experiment </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../user-guide/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../USAGE_PHASE_11/ class=md-nav__link> <span class=md-ellipsis> Dashboard Usage </span> </a> </li> <li class=md-nav__item> <a href=../../../USER_GUIDE/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../api/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../../API_REFERENCE/ class=md-nav__link> <span class=md-ellipsis> REST API </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Research </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../research/ class=md-nav__link> <span class=md-ellipsis> Research </span> </a> </li> <li class=md-nav__item> <a href=../../../research/pinn-theory/ class=md-nav__link> <span class=md-ellipsis> PINN Theory </span> </a> </li> <li class=md-nav__item> <a href=../../../research/xai-methods/ class=md-nav__link> <span class=md-ellipsis> XAI Methods </span> </a> </li> <li class=md-nav__item> <a href=../../../research/ensemble-strategies/ class=md-nav__link> <span class=md-ellipsis> Ensemble Strategies </span> </a> </li> <li class=md-nav__item> <a href=../../../research/ablation-studies/ class=md-nav__link> <span class=md-ellipsis> Ablation Studies </span> </a> </li> <li class=md-nav__item> <a href=../../../research/reproducibility/ class=md-nav__link> <span class=md-ellipsis> Reproducibility </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../DEPLOYMENT_GUIDE/ class=md-nav__link> <span class=md-ellipsis> Deployment Guide </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../CHANGELOG.md class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#31-objectives class=md-nav__link> <span class=md-ellipsis> 3.1 OBJECTIVES </span> </a> <nav class=md-nav aria-label="3.1 OBJECTIVES"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#primary-objective class=md-nav__link> <span class=md-ellipsis> Primary Objective </span> </a> </li> <li class=md-nav__item> <a href=#success-criteria class=md-nav__link> <span class=md-ellipsis> Success Criteria </span> </a> </li> <li class=md-nav__item> <a href=#business-value class=md-nav__link> <span class=md-ellipsis> Business Value </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#32-technical-architecture class=md-nav__link> <span class=md-ellipsis> 3.2 TECHNICAL ARCHITECTURE </span> </a> <nav class=md-nav aria-label="3.2 TECHNICAL ARCHITECTURE"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#high-level-flow class=md-nav__link> <span class=md-ellipsis> High-Level Flow </span> </a> </li> <li class=md-nav__item> <a href=#email-provider-decision-matrix class=md-nav__link> <span class=md-ellipsis> Email Provider Decision Matrix </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#33-database-schema class=md-nav__link> <span class=md-ellipsis> 3.3 DATABASE SCHEMA </span> </a> <nav class=md-nav aria-label="3.3 DATABASE SCHEMA"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#new-tables class=md-nav__link> <span class=md-ellipsis> New Tables </span> </a> </li> <li class=md-nav__item> <a href=#default-preferences-on-user-creation class=md-nav__link> <span class=md-ellipsis> Default Preferences on User Creation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#34-event-types-trigger-points class=md-nav__link> <span class=md-ellipsis> 3.4 EVENT TYPES &amp; TRIGGER POINTS </span> </a> <nav class=md-nav aria-label="3.4 EVENT TYPES & TRIGGER POINTS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#event-catalog class=md-nav__link> <span class=md-ellipsis> Event Catalog </span> </a> </li> <li class=md-nav__item> <a href=#example-how-to-emit-event-from-training-task class=md-nav__link> <span class=md-ellipsis> Example: How to Emit Event from Training Task </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#35-email-templates class=md-nav__link> <span class=md-ellipsis> 3.5 EMAIL TEMPLATES </span> </a> <nav class=md-nav aria-label="3.5 EMAIL TEMPLATES"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#template-structure class=md-nav__link> <span class=md-ellipsis> Template Structure </span> </a> </li> <li class=md-nav__item> <a href=#template-requirements class=md-nav__link> <span class=md-ellipsis> Template Requirements </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#36-implementation-plan-day-by-day class=md-nav__link> <span class=md-ellipsis> 3.6 IMPLEMENTATION PLAN (DAY-BY-DAY) </span> </a> <nav class=md-nav aria-label="3.6 IMPLEMENTATION PLAN (DAY-BY-DAY)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#day-1-database-setup-sendgrid-integration class=md-nav__link> <span class=md-ellipsis> Day 1: Database Setup &amp; SendGrid Integration </span> </a> </li> <li class=md-nav__item> <a href=#day-2-notification-service-core-logic class=md-nav__link> <span class=md-ellipsis> Day 2: Notification Service (Core Logic) </span> </a> </li> <li class=md-nav__item> <a href=#day-3-email-templates-jinja2 class=md-nav__link> <span class=md-ellipsis> Day 3: Email Templates (Jinja2) </span> </a> </li> <li class=md-nav__item> <a href=#day-4-email-provider-integration-sendgrid class=md-nav__link> <span class=md-ellipsis> Day 4: Email Provider Integration (SendGrid) </span> </a> </li> <li class=md-nav__item> <a href=#day-5-integrate-with-training-tasks class=md-nav__link> <span class=md-ellipsis> Day 5: Integrate with Training Tasks </span> </a> </li> <li class=md-nav__item> <a href=#day-6-user-preferences-ui class=md-nav__link> <span class=md-ellipsis> Day 6: User Preferences UI </span> </a> </li> <li class=md-nav__item> <a href=#day-7-weekly-digest-implementation class=md-nav__link> <span class=md-ellipsis> Day 7: Weekly Digest Implementation </span> </a> </li> <li class=md-nav__item> <a href=#day-8-9-email-logging-monitoring class=md-nav__link> <span class=md-ellipsis> Day 8-9: Email Logging &amp; Monitoring </span> </a> </li> <li class=md-nav__item> <a href=#day-10-final-testing-documentation class=md-nav__link> <span class=md-ellipsis> Day 10: Final Testing &amp; Documentation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#37-dos-and-donts class=md-nav__link> <span class=md-ellipsis> 3.7 DO'S AND DON'TS </span> </a> <nav class=md-nav aria-label="3.7 DO'S AND DON'TS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dos class=md-nav__link> <span class=md-ellipsis> ✅ DO's </span> </a> </li> <li class=md-nav__item> <a href=#donts class=md-nav__link> <span class=md-ellipsis> ❌ DON'Ts </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#38-testing-checklist class=md-nav__link> <span class=md-ellipsis> 3.8 TESTING CHECKLIST </span> </a> <nav class=md-nav aria-label="3.8 TESTING CHECKLIST"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unit-tests-teststest_notification_servicepy class=md-nav__link> <span class=md-ellipsis> Unit Tests (tests/test_notification_service.py) </span> </a> </li> <li class=md-nav__item> <a href=#integration-tests-testsintegrationtest_email_flowpy class=md-nav__link> <span class=md-ellipsis> Integration Tests (tests/integration/test_email_flow.py) </span> </a> </li> <li class=md-nav__item> <a href=#manual-qa-checklist class=md-nav__link> <span class=md-ellipsis> Manual QA Checklist </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#39-success-metrics class=md-nav__link> <span class=md-ellipsis> 3.9 SUCCESS METRICS </span> </a> <nav class=md-nav aria-label="3.9 SUCCESS METRICS"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quantitative class=md-nav__link> <span class=md-ellipsis> Quantitative </span> </a> </li> <li class=md-nav__item> <a href=#qualitative class=md-nav__link> <span class=md-ellipsis> Qualitative </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#310-rollout-plan class=md-nav__link> <span class=md-ellipsis> 3.10 ROLLOUT PLAN </span> </a> <nav class=md-nav aria-label="3.10 ROLLOUT PLAN"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#phase-1-internal-beta-day-1-2-of-week-2 class=md-nav__link> <span class=md-ellipsis> Phase 1: Internal Beta (Day 1-2 of Week 2) </span> </a> </li> <li class=md-nav__item> <a href=#phase-2-limited-rollout-day-3-4-of-week-2 class=md-nav__link> <span class=md-ellipsis> Phase 2: Limited Rollout (Day 3-4 of Week 2) </span> </a> </li> <li class=md-nav__item> <a href=#phase-3-general-availability-day-5-of-week-2 class=md-nav__link> <span class=md-ellipsis> Phase 3: General Availability (Day 5 of Week 2) </span> </a> </li> <li class=md-nav__item> <a href=#rollback-plan class=md-nav__link> <span class=md-ellipsis> Rollback Plan </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#311-future-enhancements-post-mvp class=md-nav__link> <span class=md-ellipsis> 3.11 FUTURE ENHANCEMENTS (Post-MVP) </span> </a> <nav class=md-nav aria-label="3.11 FUTURE ENHANCEMENTS (Post-MVP)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#phase-2-features-if-email-notifications-are-successful class=md-nav__link> <span class=md-ellipsis> Phase 2 Features (if email notifications are successful): </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=feature-3-email-notifications>FEATURE #3: EMAIL NOTIFICATIONS<a class=headerlink href=#feature-3-email-notifications title="Permanent link">&para;</a></h1> <p><strong>Duration:</strong> 1-2 weeks (7-10 days)<br> <strong>Priority:</strong> P0 (High - Professional UX requirement)<br> <strong>Assigned To:</strong> Full-Stack Developer</p> <hr> <h2 id=31-objectives>3.1 OBJECTIVES<a class=headerlink href=#31-objectives title="Permanent link">&para;</a></h2> <h3 id=primary-objective>Primary Objective<a class=headerlink href=#primary-objective title="Permanent link">&para;</a></h3> <p>Implement a multi-channel email notification system that automatically alerts users about critical events (training completion, failures, HPO results) to reduce the need for constant dashboard monitoring and improve user engagement.</p> <h3 id=success-criteria>Success Criteria<a class=headerlink href=#success-criteria title="Permanent link">&para;</a></h3> <ul> <li>Users receive emails within 60 seconds of event occurrence</li> <li>Email delivery rate &gt;98% (using SendGrid/AWS SES)</li> <li>Users can configure notification preferences per event type</li> <li>Emails are mobile-responsive and professional-looking</li> <li>Unsubscribe mechanism complies with CAN-SPAM Act</li> <li>Email logs are stored for audit trail (who received what, when)</li> <li>System handles email service failures gracefully (retry logic, fallback)</li> </ul> <h3 id=business-value>Business Value<a class=headerlink href=#business-value title="Permanent link">&para;</a></h3> <ul> <li><strong>Reduced Monitoring Burden:</strong> Users don't need to refresh dashboard every 5 minutes</li> <li><strong>Faster Response Time:</strong> Get notified immediately when training fails → Fix → Restart</li> <li><strong>Professional Image:</strong> Polished emails = enterprise-ready product</li> <li><strong>User Retention:</strong> Email notifications keep users engaged even when not actively using dashboard</li> <li><strong>Compliance Ready:</strong> Audit trail for enterprise customers</li> </ul> <hr> <h2 id=32-technical-architecture>3.2 TECHNICAL ARCHITECTURE<a class=headerlink href=#32-technical-architecture title="Permanent link">&para;</a></h2> <h3 id=high-level-flow>High-Level Flow<a class=headerlink href=#high-level-flow title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>EVENT OCCURS (e.g., training completes)
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    ↓
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>Training Task (Celery) emits event
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    ↓
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>Notification Service captures event
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    ↓
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>Check User Preferences (database query)
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    ↓
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>Should send email for this event? (Yes/No)
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    ↓ (Yes)
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>Load Email Template (Jinja2)
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    ↓
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>Render Template with event data
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>    ↓
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>Send via Email Provider (SendGrid/SES)
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>    ↓
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>Log to database (email_logs table)
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>    ↓
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>Handle result (success/failure/retry)
</span></code></pre></div> <h3 id=email-provider-decision-matrix>Email Provider Decision Matrix<a class=headerlink href=#email-provider-decision-matrix title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Provider</th> <th>Pros</th> <th>Cons</th> <th>Cost</th> <th>Recommendation</th> </tr> </thead> <tbody> <tr> <td><strong>SendGrid</strong></td> <td>Easy setup, good deliverability, generous free tier (100 emails/day)</td> <td>Requires API key, US-based</td> <td>Free: 100/day, $15/mo: 40k/mo</td> <td>✅ <strong>Best for MVP</strong></td> </tr> <tr> <td><strong>AWS SES</strong></td> <td>Cheapest at scale ($0.10/1000), AWS integration</td> <td>Complex setup (verify domain, SPF/DKIM), slower onboarding</td> <td>$0.10/1000 emails</td> <td>Production scale (&gt;10k emails/mo)</td> </tr> <tr> <td><strong>Mailgun</strong></td> <td>Good API, EU region option</td> <td>More expensive ($35/mo for 50k)</td> <td>$35/mo base</td> <td>If EU data residency required</td> </tr> <tr> <td><strong>Postmark</strong></td> <td>Best deliverability (transactional focus)</td> <td>Most expensive ($15/mo for 10k)</td> <td>$15/mo</td> <td>If deliverability critical</td> </tr> </tbody> </table> <p><strong>Decision:</strong> Start with <strong>SendGrid</strong> (free tier covers MVP), migrate to <strong>AWS SES</strong> when sending &gt;50k emails/month.</p> <hr> <h2 id=33-database-schema>3.3 DATABASE SCHEMA<a class=headerlink href=#33-database-schema title="Permanent link">&para;</a></h2> <h3 id=new-tables>New Tables<a class=headerlink href=#new-tables title="Permanent link">&para;</a></h3> <div class="language-sql highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>-- Table 1: User notification preferences</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>notification_preferences</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=n>event_type</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;training.complete&#39;, &#39;training.failed&#39;, etc.</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=c1>-- Channel preferences (true = enabled)</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=n>email_enabled</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=n>in_app_enabled</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>TRUE</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Toast notifications (already implemented in 11D)</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span><span class=n>slack_enabled</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=n>webhook_enabled</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>    </span><span class=c1>-- Email-specific settings</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=n>email_frequency</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39;immediate&#39;</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;immediate&#39;, &#39;digest_daily&#39;, &#39;digest_weekly&#39;</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=n>updated_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>(),</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>    </span><span class=k>UNIQUE</span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span><span class=w> </span><span class=n>event_type</span><span class=p>)</span><span class=w>  </span><span class=c1>-- One preference per user per event type</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=p>);</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_notif_prefs_user</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>notification_preferences</span><span class=p>(</span><span class=n>user_id</span><span class=p>);</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_notif_prefs_event</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>notification_preferences</span><span class=p>(</span><span class=n>event_type</span><span class=p>);</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=c1>-- Table 2: Email logs (audit trail + debugging)</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>email_logs</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>    </span><span class=n>recipient_email</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>    </span><span class=n>event_type</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>    </span><span class=n>subject</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>    </span><span class=n>template_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>  </span><span class=c1>-- e.g., &#39;training_complete.html&#39;</span>
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a>
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>    </span><span class=c1>-- Metadata</span>
</span><span id=__span-1-36><a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>    </span><span class=n>event_data</span><span class=w> </span><span class=n>JSONB</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Store event details (experiment_id, accuracy, etc.)</span>
</span><span id=__span-1-37><a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a>
</span><span id=__span-1-38><a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=w>    </span><span class=c1>-- Sending details</span>
</span><span id=__span-1-39><a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=w>    </span><span class=n>provider</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span><span class=w>  </span><span class=c1>-- &#39;sendgrid&#39;, &#39;ses&#39;, &#39;smtp&#39;</span>
</span><span id=__span-1-40><a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=w>    </span><span class=n>message_id</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span><span class=w>  </span><span class=c1>-- Provider&#39;s message ID (for tracking)</span>
</span><span id=__span-1-41><a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a>
</span><span id=__span-1-42><a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=w>    </span><span class=n>status</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;sent&#39;, &#39;failed&#39;, &#39;bounced&#39;, &#39;pending&#39;</span>
</span><span id=__span-1-43><a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=w>    </span><span class=n>error_message</span><span class=w> </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>  </span><span class=c1>-- If status = &#39;failed&#39;</span>
</span><span id=__span-1-44><a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a>
</span><span id=__span-1-45><a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a><span class=w>    </span><span class=n>sent_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-1-46><a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a><span class=w>    </span><span class=n>delivered_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span><span class=w>  </span><span class=c1>-- From webhook (if provider supports)</span>
</span><span id=__span-1-47><a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=w>    </span><span class=n>opened_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span><span class=w>  </span><span class=c1>-- From tracking pixel (optional)</span>
</span><span id=__span-1-48><a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=w>    </span><span class=n>clicked_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span><span class=w>  </span><span class=c1>-- From link tracking (optional)</span>
</span><span id=__span-1-49><a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a>
</span><span id=__span-1-50><a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a><span class=w>    </span><span class=n>retry_count</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-1-51><a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a>
</span><span id=__span-1-52><a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a><span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span>
</span><span id=__span-1-53><a id=__codelineno-1-53 name=__codelineno-1-53 href=#__codelineno-1-53></a><span class=p>);</span>
</span><span id=__span-1-54><a id=__codelineno-1-54 name=__codelineno-1-54 href=#__codelineno-1-54></a>
</span><span id=__span-1-55><a id=__codelineno-1-55 name=__codelineno-1-55 href=#__codelineno-1-55></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_email_logs_user</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>email_logs</span><span class=p>(</span><span class=n>user_id</span><span class=p>);</span>
</span><span id=__span-1-56><a id=__codelineno-1-56 name=__codelineno-1-56 href=#__codelineno-1-56></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_email_logs_status</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>email_logs</span><span class=p>(</span><span class=n>status</span><span class=p>);</span>
</span><span id=__span-1-57><a id=__codelineno-1-57 name=__codelineno-1-57 href=#__codelineno-1-57></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_email_logs_sent_at</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>email_logs</span><span class=p>(</span><span class=n>sent_at</span><span class=w> </span><span class=k>DESC</span><span class=p>);</span>
</span><span id=__span-1-58><a id=__codelineno-1-58 name=__codelineno-1-58 href=#__codelineno-1-58></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_email_logs_event</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>email_logs</span><span class=p>(</span><span class=n>event_type</span><span class=p>);</span>
</span><span id=__span-1-59><a id=__codelineno-1-59 name=__codelineno-1-59 href=#__codelineno-1-59></a>
</span><span id=__span-1-60><a id=__codelineno-1-60 name=__codelineno-1-60 href=#__codelineno-1-60></a><span class=c1>-- Table 3: Email digest queue (for daily/weekly digests)</span>
</span><span id=__span-1-61><a id=__codelineno-1-61 name=__codelineno-1-61 href=#__codelineno-1-61></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>email_digest_queue</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-1-62><a id=__codelineno-1-62 name=__codelineno-1-62 href=#__codelineno-1-62></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-1-63><a id=__codelineno-1-63 name=__codelineno-1-63 href=#__codelineno-1-63></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=nb>INTEGER</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
</span><span id=__span-1-64><a id=__codelineno-1-64 name=__codelineno-1-64 href=#__codelineno-1-64></a><span class=w>    </span><span class=n>event_type</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-65><a id=__codelineno-1-65 name=__codelineno-1-65 href=#__codelineno-1-65></a><span class=w>    </span><span class=n>event_data</span><span class=w> </span><span class=n>JSONB</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-1-66><a id=__codelineno-1-66 name=__codelineno-1-66 href=#__codelineno-1-66></a><span class=w>    </span><span class=n>scheduled_for</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>  </span><span class=c1>-- When to send digest</span>
</span><span id=__span-1-67><a id=__codelineno-1-67 name=__codelineno-1-67 href=#__codelineno-1-67></a><span class=w>    </span><span class=n>included_in_digest</span><span class=w> </span><span class=nb>BOOLEAN</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>FALSE</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Has been included in sent digest</span>
</span><span id=__span-1-68><a id=__codelineno-1-68 name=__codelineno-1-68 href=#__codelineno-1-68></a><span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>NOW</span><span class=p>()</span>
</span><span id=__span-1-69><a id=__codelineno-1-69 name=__codelineno-1-69 href=#__codelineno-1-69></a><span class=p>);</span>
</span><span id=__span-1-70><a id=__codelineno-1-70 name=__codelineno-1-70 href=#__codelineno-1-70></a>
</span><span id=__span-1-71><a id=__codelineno-1-71 name=__codelineno-1-71 href=#__codelineno-1-71></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_digest_queue_user</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>email_digest_queue</span><span class=p>(</span><span class=n>user_id</span><span class=p>);</span>
</span><span id=__span-1-72><a id=__codelineno-1-72 name=__codelineno-1-72 href=#__codelineno-1-72></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_digest_queue_scheduled</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>email_digest_queue</span><span class=p>(</span><span class=n>scheduled_for</span><span class=p>);</span>
</span><span id=__span-1-73><a id=__codelineno-1-73 name=__codelineno-1-73 href=#__codelineno-1-73></a><span class=k>CREATE</span><span class=w> </span><span class=k>INDEX</span><span class=w> </span><span class=n>idx_digest_queue_included</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>email_digest_queue</span><span class=p>(</span><span class=n>included_in_digest</span><span class=p>)</span><span class=w> </span>
</span><span id=__span-1-74><a id=__codelineno-1-74 name=__codelineno-1-74 href=#__codelineno-1-74></a><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>included_in_digest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>FALSE</span><span class=p>;</span><span class=w>  </span><span class=c1>-- Partial index for pending items</span>
</span></code></pre></div> <h3 id=default-preferences-on-user-creation>Default Preferences on User Creation<a class=headerlink href=#default-preferences-on-user-creation title="Permanent link">&para;</a></h3> <p>When a new user is created, populate <code>notification_preferences</code> with defaults:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>Default Preferences:
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>- training.complete:     email=true, frequency=immediate
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>- training.failed:       email=true, frequency=immediate
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>- training.started:      email=false (too noisy)
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>- hpo.campaign_complete: email=true, frequency=immediate
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>- hpo.trial_complete:    email=false (too noisy)
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>- accuracy.milestone:    email=false (optional feature)
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>- system.maintenance:    email=true, frequency=immediate
</span></code></pre></div> <hr> <h2 id=34-event-types-trigger-points>3.4 EVENT TYPES &amp; TRIGGER POINTS<a class=headerlink href=#34-event-types-trigger-points title="Permanent link">&para;</a></h2> <h3 id=event-catalog>Event Catalog<a class=headerlink href=#event-catalog title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Event Type</th> <th>Trigger Point (Code Location)</th> <th>Priority</th> <th>Default Email?</th> </tr> </thead> <tbody> <tr> <td><code>training.started</code></td> <td><code>tasks/training_tasks.py</code> → start of <code>train_model()</code></td> <td>Low</td> <td>No (too noisy)</td> </tr> <tr> <td><code>training.complete</code></td> <td><code>tasks/training_tasks.py</code> → end of <code>train_model()</code> (success)</td> <td>High</td> <td>✅ Yes</td> </tr> <tr> <td><code>training.failed</code></td> <td><code>tasks/training_tasks.py</code> → exception handler</td> <td>Critical</td> <td>✅ Yes</td> </tr> <tr> <td><code>training.paused</code></td> <td><code>tasks/training_tasks.py</code> → manual pause action</td> <td>Medium</td> <td>No</td> </tr> <tr> <td><code>training.resumed</code></td> <td><code>tasks/training_tasks.py</code> → resume after pause</td> <td>Low</td> <td>No</td> </tr> <tr> <td><code>hpo.campaign_started</code></td> <td><code>tasks/hpo_tasks.py</code> → start of HPO campaign</td> <td>Low</td> <td>No</td> </tr> <tr> <td><code>hpo.trial_complete</code></td> <td><code>tasks/hpo_tasks.py</code> → end of single trial</td> <td>Low</td> <td>No (would send 100+ emails)</td> </tr> <tr> <td><code>hpo.campaign_complete</code></td> <td><code>tasks/hpo_tasks.py</code> → all trials finished</td> <td>High</td> <td>✅ Yes</td> </tr> <tr> <td><code>hpo.campaign_failed</code></td> <td><code>tasks/hpo_tasks.py</code> → exception handler</td> <td>High</td> <td>✅ Yes</td> </tr> <tr> <td><code>accuracy.milestone</code></td> <td><code>tasks/training_tasks.py</code> → after epoch if acc &gt; threshold</td> <td>Medium</td> <td>No (optional feature)</td> </tr> <tr> <td><code>model.deployed</code></td> <td><code>api/v1/models.py</code> → deploy endpoint</td> <td>Medium</td> <td>No (future feature)</td> </tr> <tr> <td><code>system.maintenance</code></td> <td>Admin panel</td> <td>Critical</td> <td>✅ Yes</td> </tr> </tbody> </table> <h3 id=example-how-to-emit-event-from-training-task>Example: How to Emit Event from Training Task<a class=headerlink href=#example-how-to-emit-event-from-training-task title="Permanent link">&para;</a></h3> <p><strong>Before (Phase 11B):</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># tasks/training_tasks.py</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nd>@celery_app</span><span class=o>.</span><span class=n>task</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>def</span><span class=w> </span><span class=nf>train_model</span><span class=p>(</span><span class=n>experiment_id</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>        <span class=c1># ... training code ...</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>        <span class=c1># Save results</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>        <span class=n>experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;completed&#39;</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>        <span class=n>experiment</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=n>final_metrics</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>        <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span> <span class=s1>&#39;accuracy&#39;</span><span class=p>:</span> <span class=n>final_accuracy</span><span class=p>}</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>        <span class=n>experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;failed&#39;</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>        <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>        <span class=k>raise</span>
</span></code></pre></div></p> <p><strong>After (with notifications):</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># tasks/training_tasks.py</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=kn>from</span><span class=w> </span><span class=nn>services.notification_service</span><span class=w> </span><span class=kn>import</span> <span class=n>NotificationService</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=nd>@celery_app</span><span class=o>.</span><span class=n>task</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=k>def</span><span class=w> </span><span class=nf>train_model</span><span class=p>(</span><span class=n>experiment_id</span><span class=p>,</span> <span class=n>config</span><span class=p>):</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>        <span class=c1># ... training code ...</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>        <span class=c1># Save results</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>        <span class=n>experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;completed&#39;</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>        <span class=n>experiment</span><span class=o>.</span><span class=n>metrics</span> <span class=o>=</span> <span class=n>final_metrics</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>        <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>        <span class=c1># EMIT NOTIFICATION EVENT</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>        <span class=n>NotificationService</span><span class=o>.</span><span class=n>emit_event</span><span class=p>(</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>            <span class=n>event_type</span><span class=o>=</span><span class=s1>&#39;training.complete&#39;</span><span class=p>,</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>experiment</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>            <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>                <span class=s1>&#39;experiment_id&#39;</span><span class=p>:</span> <span class=n>experiment_id</span><span class=p>,</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>                <span class=s1>&#39;experiment_name&#39;</span><span class=p>:</span> <span class=n>experiment</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>                <span class=s1>&#39;accuracy&#39;</span><span class=p>:</span> <span class=n>final_accuracy</span><span class=p>,</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>                <span class=s1>&#39;duration_seconds&#39;</span><span class=p>:</span> <span class=n>duration</span><span class=p>,</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>                <span class=s1>&#39;model_type&#39;</span><span class=p>:</span> <span class=n>experiment</span><span class=o>.</span><span class=n>model_type</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>            <span class=p>}</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>        <span class=p>)</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span> <span class=s1>&#39;accuracy&#39;</span><span class=p>:</span> <span class=n>final_accuracy</span><span class=p>}</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>        <span class=n>experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;failed&#39;</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>        <span class=n>experiment</span><span class=o>.</span><span class=n>error_message</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>        <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>        <span class=c1># EMIT FAILURE EVENT</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>        <span class=n>NotificationService</span><span class=o>.</span><span class=n>emit_event</span><span class=p>(</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>            <span class=n>event_type</span><span class=o>=</span><span class=s1>&#39;training.failed&#39;</span><span class=p>,</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>experiment</span><span class=o>.</span><span class=n>user_id</span><span class=p>,</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>            <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>                <span class=s1>&#39;experiment_id&#39;</span><span class=p>:</span> <span class=n>experiment_id</span><span class=p>,</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>                <span class=s1>&#39;experiment_name&#39;</span><span class=p>:</span> <span class=n>experiment</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a>                <span class=s1>&#39;error_message&#39;</span><span class=p>:</span> <span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>),</span>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>                <span class=s1>&#39;stack_trace&#39;</span><span class=p>:</span> <span class=n>traceback</span><span class=o>.</span><span class=n>format_exc</span><span class=p>()</span>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a>            <span class=p>}</span>
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a>        <span class=p>)</span>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a>        <span class=k>raise</span>
</span></code></pre></div></p> <p><strong>Key Point:</strong> Training tasks should NOT know about email implementation details. They just emit generic events. Notification service handles routing to appropriate channels.</p> <hr> <h2 id=35-email-templates>3.5 EMAIL TEMPLATES<a class=headerlink href=#35-email-templates title="Permanent link">&para;</a></h2> <h3 id=template-structure>Template Structure<a class=headerlink href=#template-structure title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>notifications/email_templates/
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>├── base.html                      # Base template (header, footer, styling)
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>├── training_complete.html         # Training success
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>├── training_failed.html           # Training failure
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>├── hpo_campaign_complete.html     # HPO finished
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>├── hpo_campaign_failed.html       # HPO error
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>├── weekly_digest.html             # Summary of week&#39;s activity
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>├── system_maintenance.html        # Maintenance announcement
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>└── components/
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    ├── header.html                # Email header (logo, branding)
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    ├── footer.html                # Footer (links, unsubscribe)
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    └── button.html                # Reusable button component
</span></code></pre></div> <h3 id=template-requirements>Template Requirements<a class=headerlink href=#template-requirements title="Permanent link">&para;</a></h3> <p><strong>1. Base Template (<code>base.html</code>)</strong> - Mobile-responsive (media queries for &lt;600px width) - Inline CSS (email clients strip <code>&lt;style&gt;</code> tags) - Safe colors (avoid pure black #000, use #333) - Alt text for images (accessibility) - Unsubscribe link in footer (legal requirement) - Plain text fallback (for email clients that don't render HTML)</p> <p><strong>2. Training Complete Template</strong></p> <p><strong>Visual Structure:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>┌────────────────────────────────────────────┐
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>│  [Logo]  Bearing Fault Diagnosis Dashboard │
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>├────────────────────────────────────────────┤
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>│                                            │
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>│  🎉 Training Complete!                     │
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>│                                            │
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>│  Your model ResNet34_Standard has         │
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>│  finished training.                        │
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>│                                            │
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>│  ┌──────────────────────────────────────┐ │
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>│  │  Accuracy:     96.8%                 │ │
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>│  │  Precision:    96.5%                 │ │
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>│  │  Recall:       96.7%                 │ │
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>│  │  F1-Score:     96.6%                 │ │
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>│  │  Duration:     14m 32s               │ │
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>│  └──────────────────────────────────────┘ │
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>│                                            │
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>│  [View Full Results →]                     │
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>│                                            │
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>│  Next steps:                               │
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>│  • Compare with other models               │
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>│  • Deploy to production                    │
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>│  • Run inference on new data               │
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>│                                            │
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>├────────────────────────────────────────────┤
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>│  Manage notification preferences | Unsubscribe │
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a>│  © 2025 Your Company                       │
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>└────────────────────────────────────────────┘
</span></code></pre></div></p> <p><strong>Template Variables (Jinja2):</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>{{ experiment_name }}          # &quot;ResNet34_Standard&quot;
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>{{ experiment_id }}            # 1234
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>{{ accuracy }}                 # 0.968 → format as 96.8%
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>{{ precision }}                # 0.965
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>{{ recall }}                   # 0.967
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>{{ f1_score }}                 # 0.966
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>{{ duration_minutes }}         # 14
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>{{ duration_seconds }}         # 32
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>{{ results_url }}              # https://dashboard.com/experiment/1234/results
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>{{ user_first_name }}          # &quot;Abbas&quot;
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>{{ unsubscribe_url }}          # https://dashboard.com/settings/notifications?unsubscribe=training.complete
</span></code></pre></div></p> <p><strong>3. Training Failed Template</strong></p> <p><strong>Visual Structure:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>┌────────────────────────────────────────────┐
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>│  [Logo]  Bearing Fault Diagnosis Dashboard │
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>├────────────────────────────────────────────┤
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>│                                            │
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>│  ⚠️ Training Failed                        │
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>│                                            │
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>│  Your experiment ResNet34_Standard         │
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>│  encountered an error.                     │
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>│                                            │
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>│  ┌──────────────────────────────────────┐ │
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>│  │  Error: CUDA out of memory           │ │
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>│  │                                      │ │
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>│  │  Suggestion:                          │ │
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>│  │  • Reduce batch size (try 16)        │ │
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>│  │  • Use a smaller model               │ │
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>│  └──────────────────────────────────────┘ │
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>│                                            │
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>│  [View Error Details →]                    │
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>│  [Start New Training →]                    │
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>│                                            │
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>├────────────────────────────────────────────┤
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>│  Manage notification preferences | Unsubscribe │
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>└────────────────────────────────────────────┘
</span></code></pre></div></p> <p><strong>Template Variables:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>{{ experiment_name }}
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>{{ experiment_id }}
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>{{ error_message }}            # &quot;CUDA out of memory&quot;
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>{{ error_suggestion }}         # Auto-generated based on error type
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>{{ error_details_url }}        # Link to full stack trace
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>{{ new_training_url }}         # Link to training config page
</span></code></pre></div></p> <p><strong>4. Weekly Digest Template</strong></p> <p><strong>Purpose:</strong> Summarize all activity from past 7 days in a single email (for users who prefer digests over immediate notifications).</p> <p><strong>Visual Structure:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>┌────────────────────────────────────────────┐
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>│  [Logo]  Your Weekly ML Summary            │
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>├────────────────────────────────────────────┤
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>│                                            │
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>│  Hi Abbas,                                 │
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>│                                            │
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>│  Here&#39;s what happened this week:           │
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>│                                            │
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>│  📊 EXPERIMENTS SUMMARY                    │
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>│  • 12 experiments completed                │
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>│  • 2 experiments failed                    │
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>│  • Best accuracy: 97.3% (Exp #1890)       │
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>│                                            │
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>│  🏆 TOP PERFORMER                          │
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>│  Experiment: PINN_OilWhirl                 │
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>│  Accuracy: 97.3%                           │
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>│  [View Results →]                          │
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>│                                            │
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>│  ⚠️ FAILED EXPERIMENTS                     │
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>│  • ResNet50_Deep (CUDA OOM)               │
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>│  • Transformer_Large (NaN loss)           │
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>│  [Review Failures →]                       │
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>│                                            │
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>│  📈 TRENDS                                 │
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a>│  Average accuracy: 96.2% (↑ 0.5% vs last week)│
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>│  Training time: 18m avg (↓ 2m faster)     │
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a>│                                            │
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a>│  [View Full Dashboard →]                   │
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a>│                                            │
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>├────────────────────────────────────────────┤
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>│  Change digest frequency | Unsubscribe     │
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a>└────────────────────────────────────────────┘
</span></code></pre></div></p> <p><strong>Data Aggregation Logic:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>Query (for past 7 days):
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>- SELECT COUNT(*) FROM experiments WHERE status=&#39;completed&#39; AND created_at &gt; NOW() - INTERVAL &#39;7 days&#39;
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>- SELECT MAX(accuracy) FROM experiments WHERE created_at &gt; NOW() - INTERVAL &#39;7 days&#39;
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>- SELECT * FROM experiments WHERE status=&#39;failed&#39; AND created_at &gt; NOW() - INTERVAL &#39;7 days&#39;
</span></code></pre></div></p> <hr> <h2 id=36-implementation-plan-day-by-day>3.6 IMPLEMENTATION PLAN (DAY-BY-DAY)<a class=headerlink href=#36-implementation-plan-day-by-day title="Permanent link">&para;</a></h2> <h3 id=day-1-database-setup-sendgrid-integration>Day 1: Database Setup &amp; SendGrid Integration<a class=headerlink href=#day-1-database-setup-sendgrid-integration title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Write migration scripts for 3 new tables 2. Run migrations on dev database 3. Create SendGrid account (free tier) 4. Generate SendGrid API key 5. Store API key in environment variables (<code>.env</code> file) 6. Test SendGrid connectivity (send test email via API)</p> <p><strong>Testing Criteria:</strong> - ✅ Tables created successfully - ✅ Can insert into <code>notification_preferences</code> table - ✅ SendGrid test email delivers to inbox within 60 seconds - ✅ API key stored securely (not in Git)</p> <p><strong>Deliverable:</strong> Database schema ready, SendGrid verified working.</p> <hr> <h3 id=day-2-notification-service-core-logic>Day 2: Notification Service (Core Logic)<a class=headerlink href=#day-2-notification-service-core-logic title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Create <code>services/notification_service.py</code> 2. Implement <code>emit_event()</code> method (entry point for all notifications) 3. Implement <code>check_user_preferences()</code> (query database) 4. Implement routing logic (immediate vs digest) 5. Write unit tests for service methods</p> <p><strong>Key Methods to Implement:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>NotificationService:
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>  - emit_event(event_type, user_id, data)
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>      Purpose: Main entry point, called from training tasks
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>      Logic:
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>        1. Load user preferences for this event type
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>        2. If email_enabled=false, return early
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>        3. If frequency=&#39;immediate&#39;, call send_email()
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>        4. If frequency=&#39;digest_*&#39;, add to digest queue
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>        5. Log event to database
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>  - send_email(user_id, template_name, context)
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>      Purpose: Render template and send via provider
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>      Logic:
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>        1. Load email template (Jinja2)
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>        2. Render with context variables
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>        3. Call email provider API (SendGrid)
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a>        4. Handle response (success/failure)
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>        5. Log to email_logs table
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a>        6. If failed, schedule retry (exponential backoff)
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>  - get_user_preferences(user_id, event_type)
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>      Purpose: Query notification_preferences table
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a>      Returns: Preference object or default
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>  - create_default_preferences(user_id)
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a>      Purpose: Initialize preferences for new users
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a>      Called: From user registration flow
</span></code></pre></div> <p><strong>Error Handling Strategy:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>Error Scenarios:
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>1. SendGrid API Down (HTTP 500):
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>   Action: Retry 3 times (1s, 5s, 15s delays)
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>   If all fail: Log to Sentry, send in-app notification instead
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>2. Invalid Email Address (HTTP 400):
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>   Action: Mark as &#39;failed&#39; in email_logs, don&#39;t retry
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>   Alert: Admin notification (user has invalid email)
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>3. Rate Limit Exceeded (HTTP 429):
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>   Action: Queue for retry in 1 hour
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a>   Prevention: Implement local rate limiter (max 100 emails/min)
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>4. Template Rendering Error (Jinja2 exception):
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a>   Action: Send fallback plain text email
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>   Alert: Log error to Sentry (template bug)
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a>5. Database Connection Lost:
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>   Action: Queue notification in Redis (temporary)
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a>   Recovery: Process queue when database reconnects
</span></code></pre></div> <p><strong>Testing Criteria:</strong> - ✅ <code>emit_event()</code> successfully routes to email channel - ✅ <code>send_email()</code> calls SendGrid API with correct payload - ✅ User preferences correctly determine if email sent - ✅ Failed sends retry 3 times with exponential backoff - ✅ Email logs inserted into database for audit</p> <p><strong>Deliverable:</strong> Notification service with 90%+ test coverage.</p> <hr> <h3 id=day-3-email-templates-jinja2>Day 3: Email Templates (Jinja2)<a class=headerlink href=#day-3-email-templates-jinja2 title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Create <code>notifications/email_templates/</code> directory 2. Write <code>base.html</code> template (header, footer, styling) 3. Write <code>training_complete.html</code> template 4. Write <code>training_failed.html</code> template 5. Write <code>hpo_campaign_complete.html</code> template 6. Test templates with sample data (render locally)</p> <p><strong>Template Best Practices:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>DO&#39;s:
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>✅ Use inline CSS (style=&quot;...&quot; attributes)
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>✅ Use &lt;table&gt; for layout (better email client support than &lt;div&gt;)
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>✅ Set width=&quot;600&quot; max (standard email width)
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>✅ Include plain text version (for text-only clients)
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>✅ Add alt text to images
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>✅ Test in multiple email clients (Gmail, Outlook, Apple Mail)
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>✅ Use web-safe fonts (Arial, Helvetica, Georgia)
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>✅ Optimize images (&lt;100KB total email size)
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>DON&#39;Ts:
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>❌ Don&#39;t use JavaScript (email clients strip it)
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>❌ Don&#39;t use external CSS files (use inline)
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>❌ Don&#39;t use CSS Grid or Flexbox (poor support)
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>❌ Don&#39;t embed videos (link to YouTube instead)
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>❌ Don&#39;t use background images (unreliable)
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>❌ Don&#39;t forget unsubscribe link (legal requirement)
</span></code></pre></div> <p><strong>Template Testing Tools:</strong> - Litmus (paid, $99/mo, tests in 90+ email clients) - Email on Acid (paid, $99/mo) - Mailtrap (free, development testing) - Send test email to self in Gmail, Outlook, Apple Mail</p> <p><strong>Testing Criteria:</strong> - ✅ Templates render correctly in Gmail (desktop + mobile) - ✅ Templates render correctly in Outlook (desktop) - ✅ Templates render correctly in Apple Mail (iOS) - ✅ Plain text fallback exists and is readable - ✅ All links work (point to correct dashboard URLs) - ✅ Unsubscribe link present in footer</p> <p><strong>Deliverable:</strong> 3-5 professional, mobile-responsive email templates.</p> <hr> <h3 id=day-4-email-provider-integration-sendgrid>Day 4: Email Provider Integration (SendGrid)<a class=headerlink href=#day-4-email-provider-integration-sendgrid title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Create <code>services/email_provider.py</code> (abstraction layer) 2. Implement <code>SendGridProvider</code> class 3. Implement retry logic with exponential backoff 4. Implement rate limiting (100 emails/min) 5. Write unit tests for provider methods</p> <p><strong>Email Provider Abstraction (for future flexibility):</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># Pseudocode structure</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=k>class</span><span class=w> </span><span class=nc>EmailProvider</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Abstract base class for email providers&quot;&quot;&quot;</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>    <span class=nd>@abstractmethod</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>send</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>to</span><span class=p>,</span> <span class=n>subject</span><span class=p>,</span> <span class=n>html_body</span><span class=p>,</span> <span class=n>text_body</span><span class=p>):</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send email via provider&quot;&quot;&quot;</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>        <span class=k>pass</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>    <span class=nd>@abstractmethod</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_message_status</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message_id</span><span class=p>):</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Check delivery status&quot;&quot;&quot;</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>        <span class=k>pass</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=k>class</span><span class=w> </span><span class=nc>SendGridProvider</span><span class=p>(</span><span class=n>EmailProvider</span><span class=p>):</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>api_key</span><span class=p>):</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>        <span class=bp>self</span><span class=o>.</span><span class=n>api_key</span> <span class=o>=</span> <span class=n>api_key</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>SendGridAPIClient</span><span class=p>(</span><span class=n>api_key</span><span class=p>)</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>    <span class=k>def</span><span class=w> </span><span class=nf>send</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>to</span><span class=p>,</span> <span class=n>subject</span><span class=p>,</span> <span class=n>html_body</span><span class=p>,</span> <span class=n>text_body</span><span class=p>):</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send via SendGrid API&quot;&quot;&quot;</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a>        <span class=c1># Implementation: POST to SendGrid API</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a>        <span class=c1># Return: message_id or raise exception</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a>        <span class=k>pass</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=k>class</span><span class=w> </span><span class=nc>AWSESProvider</span><span class=p>(</span><span class=n>EmailProvider</span><span class=p>):</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>aws_access_key</span><span class=p>,</span> <span class=n>aws_secret</span><span class=p>):</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;ses&#39;</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a>    <span class=k>def</span><span class=w> </span><span class=nf>send</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>to</span><span class=p>,</span> <span class=n>subject</span><span class=p>,</span> <span class=n>html_body</span><span class=p>,</span> <span class=n>text_body</span><span class=p>):</span>
</span><span id=__span-15-32><a id=__codelineno-15-32 name=__codelineno-15-32 href=#__codelineno-15-32></a><span class=w>        </span><span class=sd>&quot;&quot;&quot;Send via AWS SES&quot;&quot;&quot;</span>
</span><span id=__span-15-33><a id=__codelineno-15-33 name=__codelineno-15-33 href=#__codelineno-15-33></a>        <span class=k>pass</span>
</span><span id=__span-15-34><a id=__codelineno-15-34 name=__codelineno-15-34 href=#__codelineno-15-34></a>
</span><span id=__span-15-35><a id=__codelineno-15-35 name=__codelineno-15-35 href=#__codelineno-15-35></a><span class=c1># Factory pattern for easy switching</span>
</span><span id=__span-15-36><a id=__codelineno-15-36 name=__codelineno-15-36 href=#__codelineno-15-36></a><span class=k>def</span><span class=w> </span><span class=nf>get_email_provider</span><span class=p>():</span>
</span><span id=__span-15-37><a id=__codelineno-15-37 name=__codelineno-15-37 href=#__codelineno-15-37></a>    <span class=n>provider_type</span> <span class=o>=</span> <span class=n>Config</span><span class=o>.</span><span class=n>EMAIL_PROVIDER</span>  <span class=c1># &#39;sendgrid&#39; or &#39;ses&#39;</span>
</span><span id=__span-15-38><a id=__codelineno-15-38 name=__codelineno-15-38 href=#__codelineno-15-38></a>    <span class=k>if</span> <span class=n>provider_type</span> <span class=o>==</span> <span class=s1>&#39;sendgrid&#39;</span><span class=p>:</span>
</span><span id=__span-15-39><a id=__codelineno-15-39 name=__codelineno-15-39 href=#__codelineno-15-39></a>        <span class=k>return</span> <span class=n>SendGridProvider</span><span class=p>(</span><span class=n>Config</span><span class=o>.</span><span class=n>SENDGRID_API_KEY</span><span class=p>)</span>
</span><span id=__span-15-40><a id=__codelineno-15-40 name=__codelineno-15-40 href=#__codelineno-15-40></a>    <span class=k>elif</span> <span class=n>provider_type</span> <span class=o>==</span> <span class=s1>&#39;ses&#39;</span><span class=p>:</span>
</span><span id=__span-15-41><a id=__codelineno-15-41 name=__codelineno-15-41 href=#__codelineno-15-41></a>        <span class=k>return</span> <span class=n>AWSESProvider</span><span class=p>(</span><span class=n>Config</span><span class=o>.</span><span class=n>AWS_ACCESS_KEY</span><span class=p>,</span> <span class=n>Config</span><span class=o>.</span><span class=n>AWS_SECRET</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Rate Limiting Implementation:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>Strategy: Token bucket algorithm (using Redis)
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>Redis key: &quot;email_rate_limit&quot;
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>Token capacity: 100 (max 100 emails/min)
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>Refill rate: 100 tokens/60 seconds = 1.67 tokens/sec
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>Before sending each email:
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>  1. Try to consume 1 token from bucket
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>  2. If token available: Proceed with send
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>  3. If no tokens: Wait 1 second, retry
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>  4. If still no tokens after 5 retries: Queue for later
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>Implementation:
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>  - Use Redis INCR/DECR for atomic operations
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>  - Set expiry on rate limit key (60 seconds)
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a>  - Prevents SendGrid rate limit errors (safer to limit ourselves)
</span></code></pre></div> <p><strong>Testing Criteria:</strong> - ✅ Send 5 emails via SendGrid → All deliver within 60 seconds - ✅ SendGrid returns message_id → Stored in email_logs - ✅ Invalid API key → Raises clear exception - ✅ Send 150 emails rapidly → Rate limiter throttles to 100/min - ✅ Retry logic: Simulate SendGrid 500 error → Retries 3 times</p> <p><strong>Deliverable:</strong> Robust email provider integration with error handling.</p> <hr> <h3 id=day-5-integrate-with-training-tasks>Day 5: Integrate with Training Tasks<a class=headerlink href=#day-5-integrate-with-training-tasks title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Modify <code>tasks/training_tasks.py</code> to emit events 2. Modify <code>tasks/hpo_tasks.py</code> to emit events 3. Test end-to-end: Start training → Receive email on completion 4. Test failure case: Force training error → Receive failure email 5. Verify email logs table populated correctly</p> <p><strong>Integration Points:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>File: tasks/training_tasks.py
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>Locations to add NotificationService.emit_event():
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>1. Line ~50: After training starts (optional, if user enables &#39;training.started&#39;)
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>   NotificationService.emit_event(&#39;training.started&#39;, user_id, {...})
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>2. Line ~300: After training completes successfully
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>   NotificationService.emit_event(&#39;training.complete&#39;, user_id, {
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>       &#39;experiment_id&#39;: experiment_id,
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>       &#39;experiment_name&#39;: experiment.name,
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>       &#39;accuracy&#39;: final_accuracy,
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>       &#39;precision&#39;: final_precision,
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>       &#39;recall&#39;: final_recall,
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>       &#39;f1_score&#39;: final_f1,
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>       &#39;duration_seconds&#39;: duration,
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a>       &#39;model_type&#39;: experiment.model_type,
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a>       &#39;results_url&#39;: f&quot;{Config.DASHBOARD_URL}/experiment/{experiment_id}/results&quot;
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a>   })
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a>3. Line ~350: In exception handler (training failed)
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a>   NotificationService.emit_event(&#39;training.failed&#39;, user_id, {
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a>       &#39;experiment_id&#39;: experiment_id,
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a>       &#39;experiment_name&#39;: experiment.name,
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a>       &#39;error_message&#39;: str(e),
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a>       &#39;error_type&#39;: type(e).__name__,
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a>       &#39;error_suggestion&#39;: get_error_suggestion(e),  # Helper function
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a>       &#39;error_details_url&#39;: f&quot;{Config.DASHBOARD_URL}/experiment/{experiment_id}/errors&quot;
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a>   })
</span></code></pre></div> <p><strong>Error Suggestion Helper (Smart Recommendations):</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=k>def</span><span class=w> </span><span class=nf>get_error_suggestion</span><span class=p>(</span><span class=n>exception</span><span class=p>):</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=sd>    Provide actionable suggestion based on error type.</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=sd>    Examples:</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=sd>    - CUDA out of memory → &quot;Reduce batch size to 16 or use smaller model&quot;</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=sd>    - NaN loss → &quot;Learning rate too high. Try 1e-4 instead of 1e-3&quot;</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=sd>    - File not found → &quot;Dataset may have been deleted. Re-upload data.&quot;</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>    <span class=n>error_suggestions</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>        <span class=s1>&#39;OutOfMemoryError&#39;</span><span class=p>:</span> <span class=s2>&quot;Reduce batch size (try 16) or use a smaller model variant&quot;</span><span class=p>,</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a>        <span class=s1>&#39;RuntimeError&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a>            <span class=s1>&#39;NaN&#39;</span><span class=p>:</span> <span class=s2>&quot;Learning rate may be too high. Try reducing to 1e-4&quot;</span><span class=p>,</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>            <span class=s1>&#39;not found&#39;</span><span class=p>:</span> <span class=s2>&quot;Required file is missing. Check dataset availability&quot;</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a>        <span class=p>},</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a>        <span class=s1>&#39;ValueError&#39;</span><span class=p>:</span> <span class=s2>&quot;Invalid configuration. Review hyperparameters&quot;</span><span class=p>,</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a>        <span class=s1>&#39;TimeoutError&#39;</span><span class=p>:</span> <span class=s2>&quot;Training exceeded time limit. Reduce epochs or early stop&quot;</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a>    <span class=p>}</span>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a>    <span class=c1># Match error type and message</span>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a>    <span class=c1># Return specific suggestion or generic fallback</span>
</span></code></pre></div> <p><strong>Testing Criteria:</strong> - ✅ Train model → Email received with correct accuracy/metrics - ✅ Force CUDA OOM error → Failure email with suggestion - ✅ Email contains clickable links to results page - ✅ Email_logs table shows successful send - ✅ No duplicate emails sent (idempotency check)</p> <p><strong>Deliverable:</strong> Training tasks integrated, end-to-end email flow working.</p> <hr> <h3 id=day-6-user-preferences-ui>Day 6: User Preferences UI<a class=headerlink href=#day-6-user-preferences-ui title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Enhance <code>layouts/settings.py</code> (Notifications tab) 2. Create UI for per-event email toggles 3. Add frequency selector (immediate, daily digest, weekly digest) 4. Implement "Test Email" button (sends sample notification) 5. Create callback handlers for saving preferences</p> <p><strong>UI Design:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>Settings → Notifications Tab
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>┌────────────────────────────────────────────────────────┐
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>│  EMAIL NOTIFICATIONS                                   │
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>├────────────────────────────────────────────────────────┤
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>│  Receive notifications via email for:                  │
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>│                                                        │
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>│  Event                      Email  Frequency           │
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>│  ──────────────────────────────────────────────────   │
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>│  Training Complete          [✓]    [Immediate ▼]      │
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>│  Training Failed            [✓]    [Immediate ▼]      │
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>│  Training Started           [ ]    [Immediate ▼]      │
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>│  HPO Campaign Complete      [✓]    [Immediate ▼]      │
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a>│  HPO Campaign Failed        [✓]    [Immediate ▼]      │
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>│  HPO Trial Complete         [ ]    [Immediate ▼]      │
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a>│  Accuracy Milestone         [ ]    [Immediate ▼]      │
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a>│  ──────────────────────────────────────────────────   │
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>│                                                        │
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a>│  Frequency Options:                                    │
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a>│  • Immediate: Receive email within 1 minute of event  │
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a>│  • Daily Digest: Summary email at 9:00 AM daily      │
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a>│  • Weekly Digest: Summary email on Monday 9:00 AM    │
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a>│                                                        │
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a>│  [Send Test Email]                                     │
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a>│  (We&#39;ll send a sample notification to abbas@...)      │
</span><span id=__span-19-26><a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a>│                                                        │
</span><span id=__span-19-27><a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a>│  [Save Preferences]                                    │
</span><span id=__span-19-28><a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a>│                                                        │
</span><span id=__span-19-29><a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a>├────────────────────────────────────────────────────────┤
</span><span id=__span-19-30><a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a>│  Email Delivery: 342 sent, 340 delivered (99.4%)      │
</span><span id=__span-19-31><a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a>│  Last email sent: 2 hours ago (Training Complete)     │
</span><span id=__span-19-32><a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a>│  [View Email Logs]                                     │
</span><span id=__span-19-33><a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a>└────────────────────────────────────────────────────────┘
</span></code></pre></div> <p><strong>Callback Logic:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Pseudocode for save preferences callback</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=nd>@callback</span><span class=p>(</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>    <span class=n>Output</span><span class=p>(</span><span class=s1>&#39;save-prefs-confirmation&#39;</span><span class=p>,</span> <span class=s1>&#39;children&#39;</span><span class=p>),</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>    <span class=n>Input</span><span class=p>(</span><span class=s1>&#39;save-preferences-btn&#39;</span><span class=p>,</span> <span class=s1>&#39;n_clicks&#39;</span><span class=p>),</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a>    <span class=n>State</span><span class=p>({</span><span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;email-toggle&#39;</span><span class=p>,</span> <span class=s1>&#39;event&#39;</span><span class=p>:</span> <span class=n>ALL</span><span class=p>},</span> <span class=s1>&#39;checked&#39;</span><span class=p>),</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a>    <span class=n>State</span><span class=p>({</span><span class=s1>&#39;type&#39;</span><span class=p>:</span> <span class=s1>&#39;frequency-dropdown&#39;</span><span class=p>,</span> <span class=s1>&#39;event&#39;</span><span class=p>:</span> <span class=n>ALL</span><span class=p>},</span> <span class=s1>&#39;value&#39;</span><span class=p>)</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=p>)</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=k>def</span><span class=w> </span><span class=nf>save_notification_preferences</span><span class=p>(</span><span class=n>n_clicks</span><span class=p>,</span> <span class=n>email_toggles</span><span class=p>,</span> <span class=n>frequencies</span><span class=p>):</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=sd>    Save user&#39;s notification preferences to database.</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>n_clicks</span><span class=p>:</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a>        <span class=k>return</span> <span class=n>no_update</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a>    <span class=n>user_id</span> <span class=o>=</span> <span class=n>get_current_user_id</span><span class=p>()</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a>    <span class=c1># Update database (UPSERT operation)</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a>    <span class=k>for</span> <span class=n>event_type</span><span class=p>,</span> <span class=n>email_enabled</span><span class=p>,</span> <span class=n>frequency</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>event_types</span><span class=p>,</span> <span class=n>email_toggles</span><span class=p>,</span> <span class=n>frequencies</span><span class=p>):</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>        <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=sd>            INSERT INTO notification_preferences (user_id, event_type, email_enabled, email_frequency)</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=sd>            VALUES (:user_id, :event_type, :email_enabled, :frequency)</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=sd>            ON CONFLICT (user_id, event_type) </span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=sd>            DO UPDATE SET </span>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=sd>                email_enabled = :email_enabled,</span>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=sd>                email_frequency = :frequency,</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=sd>                updated_at = NOW()</span>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=sd>            &quot;&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a>            <span class=p>{</span><span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=n>event_type</span><span class=p>,</span> <span class=s1>&#39;email_enabled&#39;</span><span class=p>:</span> <span class=n>email_enabled</span><span class=p>,</span> <span class=s1>&#39;frequency&#39;</span><span class=p>:</span> <span class=n>frequency</span><span class=p>}</span>
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a>        <span class=p>)</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a>
</span><span id=__span-20-34><a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a>    <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span><span id=__span-20-35><a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a>
</span><span id=__span-20-36><a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a>    <span class=k>return</span> <span class=n>dbc</span><span class=o>.</span><span class=n>Alert</span><span class=p>(</span><span class=s2>&quot;✓ Preferences saved successfully&quot;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;success&quot;</span><span class=p>,</span> <span class=n>duration</span><span class=o>=</span><span class=mi>3000</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Test Email Feature:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=nd>@callback</span><span class=p>(</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>    <span class=n>Output</span><span class=p>(</span><span class=s1>&#39;test-email-result&#39;</span><span class=p>,</span> <span class=s1>&#39;children&#39;</span><span class=p>),</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>    <span class=n>Input</span><span class=p>(</span><span class=s1>&#39;send-test-email-btn&#39;</span><span class=p>,</span> <span class=s1>&#39;n_clicks&#39;</span><span class=p>)</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=p>)</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=k>def</span><span class=w> </span><span class=nf>send_test_email</span><span class=p>(</span><span class=n>n_clicks</span><span class=p>):</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=sd>    Send a sample notification to user&#39;s email for testing.</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>n_clicks</span><span class=p>:</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>        <span class=k>return</span> <span class=n>no_update</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>    <span class=n>user</span> <span class=o>=</span> <span class=n>get_current_user</span><span class=p>()</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>    <span class=c1># Send test email using training_complete template with dummy data</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>    <span class=n>NotificationService</span><span class=o>.</span><span class=n>send_email</span><span class=p>(</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>        <span class=n>user_id</span><span class=o>=</span><span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>        <span class=n>template_name</span><span class=o>=</span><span class=s1>&#39;training_complete&#39;</span><span class=p>,</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>        <span class=n>context</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>            <span class=s1>&#39;experiment_name&#39;</span><span class=p>:</span> <span class=s1>&#39;Test_Experiment&#39;</span><span class=p>,</span>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>            <span class=s1>&#39;experiment_id&#39;</span><span class=p>:</span> <span class=mi>9999</span><span class=p>,</span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>            <span class=s1>&#39;accuracy&#39;</span><span class=p>:</span> <span class=mf>0.965</span><span class=p>,</span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>            <span class=s1>&#39;precision&#39;</span><span class=p>:</span> <span class=mf>0.963</span><span class=p>,</span>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a>            <span class=s1>&#39;recall&#39;</span><span class=p>:</span> <span class=mf>0.967</span><span class=p>,</span>
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a>            <span class=s1>&#39;f1_score&#39;</span><span class=p>:</span> <span class=mf>0.965</span><span class=p>,</span>
</span><span id=__span-21-26><a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a>            <span class=s1>&#39;duration_minutes&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-21-27><a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a>            <span class=s1>&#39;duration_seconds&#39;</span><span class=p>:</span> <span class=mi>23</span><span class=p>,</span>
</span><span id=__span-21-28><a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a>            <span class=s1>&#39;user_first_name&#39;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>first_name</span><span class=p>,</span>
</span><span id=__span-21-29><a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a>            <span class=s1>&#39;results_url&#39;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>Config</span><span class=o>.</span><span class=n>DASHBOARD_URL</span><span class=si>}</span><span class=s2>/test&quot;</span><span class=p>,</span>
</span><span id=__span-21-30><a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a>            <span class=s1>&#39;is_test&#39;</span><span class=p>:</span> <span class=kc>True</span>  <span class=c1># Flag to add &quot;[TEST EMAIL]&quot; to subject</span>
</span><span id=__span-21-31><a id=__codelineno-21-31 name=__codelineno-21-31 href=#__codelineno-21-31></a>        <span class=p>}</span>
</span><span id=__span-21-32><a id=__codelineno-21-32 name=__codelineno-21-32 href=#__codelineno-21-32></a>    <span class=p>)</span>
</span><span id=__span-21-33><a id=__codelineno-21-33 name=__codelineno-21-33 href=#__codelineno-21-33></a>
</span><span id=__span-21-34><a id=__codelineno-21-34 name=__codelineno-21-34 href=#__codelineno-21-34></a>    <span class=k>return</span> <span class=n>dbc</span><span class=o>.</span><span class=n>Alert</span><span class=p>(</span>
</span><span id=__span-21-35><a id=__codelineno-21-35 name=__codelineno-21-35 href=#__codelineno-21-35></a>        <span class=sa>f</span><span class=s2>&quot;✓ Test email sent to </span><span class=si>{</span><span class=n>user</span><span class=o>.</span><span class=n>email</span><span class=si>}</span><span class=s2>. Check your inbox in 1-2 minutes.&quot;</span><span class=p>,</span>
</span><span id=__span-21-36><a id=__codelineno-21-36 name=__codelineno-21-36 href=#__codelineno-21-36></a>        <span class=n>color</span><span class=o>=</span><span class=s2>&quot;success&quot;</span><span class=p>,</span>
</span><span id=__span-21-37><a id=__codelineno-21-37 name=__codelineno-21-37 href=#__codelineno-21-37></a>        <span class=n>duration</span><span class=o>=</span><span class=mi>5000</span>
</span><span id=__span-21-38><a id=__codelineno-21-38 name=__codelineno-21-38 href=#__codelineno-21-38></a>    <span class=p>)</span>
</span></code></pre></div> <p><strong>Testing Criteria:</strong> - ✅ Load settings page → Preferences populated from database - ✅ Toggle email for event → Saves to database - ✅ Change frequency → Updates preference - ✅ Click "Send Test Email" → Receive test email within 60 seconds - ✅ Test email has "[TEST]" prefix in subject line - ✅ View Email Logs → Shows list of sent emails</p> <p><strong>Deliverable:</strong> Functional preferences UI with test email capability.</p> <hr> <h3 id=day-7-weekly-digest-implementation>Day 7: Weekly Digest Implementation<a class=headerlink href=#day-7-weekly-digest-implementation title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Create Celery periodic task for digest generation 2. Implement digest aggregation logic (query past 7 days) 3. Create <code>weekly_digest.html</code> template 4. Test digest generation manually 5. Schedule digest to run every Monday at 9:00 AM</p> <p><strong>Celery Beat Configuration:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># config/celery_config.py</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=kn>from</span><span class=w> </span><span class=nn>celery.schedules</span><span class=w> </span><span class=kn>import</span> <span class=n>crontab</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=n>app</span><span class=o>.</span><span class=n>conf</span><span class=o>.</span><span class=n>beat_schedule</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>    <span class=c1># Daily digest (9:00 AM every day)</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>    <span class=s1>&#39;send-daily-digests&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>        <span class=s1>&#39;task&#39;</span><span class=p>:</span> <span class=s1>&#39;tasks.notification_tasks.send_daily_digests&#39;</span><span class=p>,</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>        <span class=s1>&#39;schedule&#39;</span><span class=p>:</span> <span class=n>crontab</span><span class=p>(</span><span class=n>hour</span><span class=o>=</span><span class=mi>9</span><span class=p>,</span> <span class=n>minute</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>  <span class=c1># 9:00 AM daily</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a>    <span class=p>},</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>    <span class=c1># Weekly digest (9:00 AM every Monday)</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a>    <span class=s1>&#39;send-weekly-digests&#39;</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>        <span class=s1>&#39;task&#39;</span><span class=p>:</span> <span class=s1>&#39;tasks.notification_tasks.send_weekly_digests&#39;</span><span class=p>,</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a>        <span class=s1>&#39;schedule&#39;</span><span class=p>:</span> <span class=n>crontab</span><span class=p>(</span><span class=n>hour</span><span class=o>=</span><span class=mi>9</span><span class=p>,</span> <span class=n>minute</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>day_of_week</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>  <span class=c1># Monday</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a>    <span class=p>}</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Digest Generation Logic:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># tasks/notification_tasks.py</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=nd>@celery_app</span><span class=o>.</span><span class=n>task</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=k>def</span><span class=w> </span><span class=nf>send_weekly_digests</span><span class=p>():</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=sd>    Generate and send weekly digest emails to all users who opted in.</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=sd>    Runs: Every Monday at 9:00 AM</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>    <span class=c1># 1. Find all users with digest preferences</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>    <span class=n>users_with_digest</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>User</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>        <span class=n>NotificationPreferences</span><span class=p>,</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>        <span class=n>User</span><span class=o>.</span><span class=n>id</span> <span class=o>==</span> <span class=n>NotificationPreferences</span><span class=o>.</span><span class=n>user_id</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a>    <span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>        <span class=n>NotificationPreferences</span><span class=o>.</span><span class=n>email_frequency</span><span class=o>.</span><span class=n>in_</span><span class=p>([</span><span class=s1>&#39;digest_daily&#39;</span><span class=p>,</span> <span class=s1>&#39;digest_weekly&#39;</span><span class=p>])</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>    <span class=p>)</span><span class=o>.</span><span class=n>distinct</span><span class=p>()</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>    <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users_with_digest</span><span class=p>:</span>
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>        <span class=c1># 2. Aggregate data from past 7 days</span>
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>        <span class=n>week_start</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>-</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a>        <span class=c1># Query experiments</span>
</span><span id=__span-23-24><a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a>        <span class=n>experiments_completed</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Experiment</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-23-25><a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>user_id</span> <span class=o>==</span> <span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-23-26><a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s1>&#39;completed&#39;</span><span class=p>,</span>
</span><span id=__span-23-27><a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>created_at</span> <span class=o>&gt;=</span> <span class=n>week_start</span>
</span><span id=__span-23-28><a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a>        <span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-23-29><a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a>
</span><span id=__span-23-30><a id=__codelineno-23-30 name=__codelineno-23-30 href=#__codelineno-23-30></a>        <span class=n>experiments_failed</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Experiment</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-23-31><a id=__codelineno-23-31 name=__codelineno-23-31 href=#__codelineno-23-31></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>user_id</span> <span class=o>==</span> <span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-23-32><a id=__codelineno-23-32 name=__codelineno-23-32 href=#__codelineno-23-32></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s1>&#39;failed&#39;</span><span class=p>,</span>
</span><span id=__span-23-33><a id=__codelineno-23-33 name=__codelineno-23-33 href=#__codelineno-23-33></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>created_at</span> <span class=o>&gt;=</span> <span class=n>week_start</span>
</span><span id=__span-23-34><a id=__codelineno-23-34 name=__codelineno-23-34 href=#__codelineno-23-34></a>        <span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>()</span>
</span><span id=__span-23-35><a id=__codelineno-23-35 name=__codelineno-23-35 href=#__codelineno-23-35></a>
</span><span id=__span-23-36><a id=__codelineno-23-36 name=__codelineno-23-36 href=#__codelineno-23-36></a>        <span class=c1># Find best experiment</span>
</span><span id=__span-23-37><a id=__codelineno-23-37 name=__codelineno-23-37 href=#__codelineno-23-37></a>        <span class=n>best_experiment</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>Experiment</span><span class=p>)</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-23-38><a id=__codelineno-23-38 name=__codelineno-23-38 href=#__codelineno-23-38></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>user_id</span> <span class=o>==</span> <span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-23-39><a id=__codelineno-23-39 name=__codelineno-23-39 href=#__codelineno-23-39></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s1>&#39;completed&#39;</span><span class=p>,</span>
</span><span id=__span-23-40><a id=__codelineno-23-40 name=__codelineno-23-40 href=#__codelineno-23-40></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>created_at</span> <span class=o>&gt;=</span> <span class=n>week_start</span>
</span><span id=__span-23-41><a id=__codelineno-23-41 name=__codelineno-23-41 href=#__codelineno-23-41></a>        <span class=p>)</span><span class=o>.</span><span class=n>order_by</span><span class=p>(</span><span class=n>Experiment</span><span class=o>.</span><span class=n>accuracy</span><span class=o>.</span><span class=n>desc</span><span class=p>())</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span><span id=__span-23-42><a id=__codelineno-23-42 name=__codelineno-23-42 href=#__codelineno-23-42></a>
</span><span id=__span-23-43><a id=__codelineno-23-43 name=__codelineno-23-43 href=#__codelineno-23-43></a>        <span class=c1># Calculate average accuracy</span>
</span><span id=__span-23-44><a id=__codelineno-23-44 name=__codelineno-23-44 href=#__codelineno-23-44></a>        <span class=n>avg_accuracy</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>func</span><span class=o>.</span><span class=n>avg</span><span class=p>(</span><span class=n>Experiment</span><span class=o>.</span><span class=n>accuracy</span><span class=p>))</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span>
</span><span id=__span-23-45><a id=__codelineno-23-45 name=__codelineno-23-45 href=#__codelineno-23-45></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>user_id</span> <span class=o>==</span> <span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-23-46><a id=__codelineno-23-46 name=__codelineno-23-46 href=#__codelineno-23-46></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s1>&#39;completed&#39;</span><span class=p>,</span>
</span><span id=__span-23-47><a id=__codelineno-23-47 name=__codelineno-23-47 href=#__codelineno-23-47></a>            <span class=n>Experiment</span><span class=o>.</span><span class=n>created_at</span> <span class=o>&gt;=</span> <span class=n>week_start</span>
</span><span id=__span-23-48><a id=__codelineno-23-48 name=__codelineno-23-48 href=#__codelineno-23-48></a>        <span class=p>)</span><span class=o>.</span><span class=n>scalar</span><span class=p>()</span>
</span><span id=__span-23-49><a id=__codelineno-23-49 name=__codelineno-23-49 href=#__codelineno-23-49></a>
</span><span id=__span-23-50><a id=__codelineno-23-50 name=__codelineno-23-50 href=#__codelineno-23-50></a>        <span class=c1># 3. Render digest template</span>
</span><span id=__span-23-51><a id=__codelineno-23-51 name=__codelineno-23-51 href=#__codelineno-23-51></a>        <span class=n>context</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-23-52><a id=__codelineno-23-52 name=__codelineno-23-52 href=#__codelineno-23-52></a>            <span class=s1>&#39;user_first_name&#39;</span><span class=p>:</span> <span class=n>user</span><span class=o>.</span><span class=n>first_name</span><span class=p>,</span>
</span><span id=__span-23-53><a id=__codelineno-23-53 name=__codelineno-23-53 href=#__codelineno-23-53></a>            <span class=s1>&#39;week_start&#39;</span><span class=p>:</span> <span class=n>week_start</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%B </span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>),</span>
</span><span id=__span-23-54><a id=__codelineno-23-54 name=__codelineno-23-54 href=#__codelineno-23-54></a>            <span class=s1>&#39;week_end&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%B </span><span class=si>%d</span><span class=s1>&#39;</span><span class=p>),</span>
</span><span id=__span-23-55><a id=__codelineno-23-55 name=__codelineno-23-55 href=#__codelineno-23-55></a>            <span class=s1>&#39;experiments_completed&#39;</span><span class=p>:</span> <span class=n>experiments_completed</span><span class=p>,</span>
</span><span id=__span-23-56><a id=__codelineno-23-56 name=__codelineno-23-56 href=#__codelineno-23-56></a>            <span class=s1>&#39;experiments_failed_count&#39;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>experiments_failed</span><span class=p>),</span>
</span><span id=__span-23-57><a id=__codelineno-23-57 name=__codelineno-23-57 href=#__codelineno-23-57></a>            <span class=s1>&#39;experiments_failed&#39;</span><span class=p>:</span> <span class=n>experiments_failed</span><span class=p>[:</span><span class=mi>3</span><span class=p>],</span>  <span class=c1># Top 3 failures</span>
</span><span id=__span-23-58><a id=__codelineno-23-58 name=__codelineno-23-58 href=#__codelineno-23-58></a>            <span class=s1>&#39;best_experiment&#39;</span><span class=p>:</span> <span class=n>best_experiment</span><span class=p>,</span>
</span><span id=__span-23-59><a id=__codelineno-23-59 name=__codelineno-23-59 href=#__codelineno-23-59></a>            <span class=s1>&#39;avg_accuracy&#39;</span><span class=p>:</span> <span class=n>avg_accuracy</span><span class=p>,</span>
</span><span id=__span-23-60><a id=__codelineno-23-60 name=__codelineno-23-60 href=#__codelineno-23-60></a>            <span class=s1>&#39;dashboard_url&#39;</span><span class=p>:</span> <span class=n>Config</span><span class=o>.</span><span class=n>DASHBOARD_URL</span>
</span><span id=__span-23-61><a id=__codelineno-23-61 name=__codelineno-23-61 href=#__codelineno-23-61></a>        <span class=p>}</span>
</span><span id=__span-23-62><a id=__codelineno-23-62 name=__codelineno-23-62 href=#__codelineno-23-62></a>
</span><span id=__span-23-63><a id=__codelineno-23-63 name=__codelineno-23-63 href=#__codelineno-23-63></a>        <span class=c1># 4. Send email</span>
</span><span id=__span-23-64><a id=__codelineno-23-64 name=__codelineno-23-64 href=#__codelineno-23-64></a>        <span class=n>NotificationService</span><span class=o>.</span><span class=n>send_email</span><span class=p>(</span>
</span><span id=__span-23-65><a id=__codelineno-23-65 name=__codelineno-23-65 href=#__codelineno-23-65></a>            <span class=n>user_id</span><span class=o>=</span><span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span><span id=__span-23-66><a id=__codelineno-23-66 name=__codelineno-23-66 href=#__codelineno-23-66></a>            <span class=n>template_name</span><span class=o>=</span><span class=s1>&#39;weekly_digest&#39;</span><span class=p>,</span>
</span><span id=__span-23-67><a id=__codelineno-23-67 name=__codelineno-23-67 href=#__codelineno-23-67></a>            <span class=n>context</span><span class=o>=</span><span class=n>context</span>
</span><span id=__span-23-68><a id=__codelineno-23-68 name=__codelineno-23-68 href=#__codelineno-23-68></a>        <span class=p>)</span>
</span><span id=__span-23-69><a id=__codelineno-23-69 name=__codelineno-23-69 href=#__codelineno-23-69></a>
</span><span id=__span-23-70><a id=__codelineno-23-70 name=__codelineno-23-70 href=#__codelineno-23-70></a>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;Sent </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>users_with_digest</span><span class=p>)</span><span class=si>}</span><span class=s2> weekly digests&quot;</span>
</span></code></pre></div> <p><strong>Testing Criteria:</strong> - ✅ Manually trigger digest task → Emails generated for users with digest preference - ✅ Digest contains accurate counts (completed, failed) - ✅ Best experiment highlighted correctly - ✅ Failed experiments listed with links - ✅ Trends calculated correctly (vs previous week) - ✅ Scheduled task runs at correct time (verify with Celery Beat logs)</p> <p><strong>Deliverable:</strong> Weekly digest system operational.</p> <hr> <h3 id=day-8-9-email-logging-monitoring>Day 8-9: Email Logging &amp; Monitoring<a class=headerlink href=#day-8-9-email-logging-monitoring title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. Create <code>/admin/email-logs</code> page (admin-only) 2. Display email logs table with filters 3. Add email delivery metrics (sent, delivered, bounced) 4. Implement email status webhook (SendGrid → update delivered_at) 5. Add Sentry alerting for email failures</p> <p><strong>Email Logs Page Design:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>Admin Panel → Email Logs
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>┌──────────────────────────────────────────────────────────┐
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>│  EMAIL LOGS                                              │
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>├──────────────────────────────────────────────────────────┤
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>│  Filters:                                                │
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>│  Date Range: [Last 7 Days ▼]                            │
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>│  Status: [All ▼] (Sent, Delivered, Failed, Bounced)     │
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>│  Event Type: [All ▼]                                     │
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>│  Recipient: [Search email...________]                    │
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>│  [Apply Filters]                                         │
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>│                                                          │
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>│  LOGS TABLE (Showing 1-50 of 3,421)                     │
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>│  ┌───────────┬────────────┬────────┬───────┬──────────┐ │
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>│  │ Timestamp │  Recipient │  Event │Status │ Provider │ │
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>│  ├───────────┼────────────┼────────┼───────┼──────────┤ │
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>│  │14:32:11   │abbas@...   │Train✓  │Sent ✅│SendGrid  │ │
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a>│  │14:28:05   │john@...    │HPO✓    │Deliv✅│SendGrid  │ │
</span><span id=__span-24-19><a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>│  │14:15:32   │jane@...    │Train✗  │Failed❌│SendGrid │ │
</span><span id=__span-24-20><a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>│  │ ...                                                  │ │
</span><span id=__span-24-21><a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>│  └───────────┴────────────┴────────┴───────┴──────────┘ │
</span><span id=__span-24-22><a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>│                                                          │
</span><span id=__span-24-23><a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>│  [Export CSV] [Retry Failed]                            │
</span><span id=__span-24-24><a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>│                                                          │
</span><span id=__span-24-25><a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>│  DELIVERY METRICS (Last 30 Days)                        │
</span><span id=__span-24-26><a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>│  Total Sent: 3,421                                      │
</span><span id=__span-24-27><a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a>│  Delivered: 3,401 (99.4%)                               │
</span><span id=__span-24-28><a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a>│  Failed: 15 (0.4%)                                      │
</span><span id=__span-24-29><a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a>│  Bounced: 5 (0.1%)                                      │
</span><span id=__span-24-30><a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a>│                                                          │
</span><span id=__span-24-31><a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a>│  [Chart: Emails sent per day]                           │
</span><span id=__span-24-32><a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a>└──────────────────────────────────────────────────────────┘
</span></code></pre></div> <p><strong>SendGrid Webhook for Delivery Tracking:</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># api/webhooks/sendgrid.py</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/webhooks/sendgrid&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=k>def</span><span class=w> </span><span class=nf>sendgrid_webhook</span><span class=p>():</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=sd>    Receive delivery events from SendGrid.</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=sd>    Events: delivered, bounced, opened, clicked, spam_report</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=sd>    SendGrid sends POST request with event data when email status changes.</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>    <span class=c1># Verify request is from SendGrid (signature verification)</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>verify_sendgrid_signature</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a>        <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;error&#39;</span><span class=p>:</span> <span class=s1>&#39;Unauthorized&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a>    <span class=n>events</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>get_json</span><span class=p>()</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a>    <span class=k>for</span> <span class=n>event</span> <span class=ow>in</span> <span class=n>events</span><span class=p>:</span>
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a>        <span class=n>event_type</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;event&#39;</span><span class=p>]</span>  <span class=c1># &#39;delivered&#39;, &#39;bounced&#39;, etc.</span>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a>        <span class=n>message_id</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;sg_message_id&#39;</span><span class=p>]</span>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a>        <span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromtimestamp</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s1>&#39;timestamp&#39;</span><span class=p>])</span>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a>        <span class=c1># Update email_logs table</span>
</span><span id=__span-25-25><a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a>        <span class=n>email_log</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>EmailLog</span><span class=p>)</span><span class=o>.</span><span class=n>filter_by</span><span class=p>(</span><span class=n>message_id</span><span class=o>=</span><span class=n>message_id</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
</span><span id=__span-25-26><a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a>
</span><span id=__span-25-27><a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a>        <span class=k>if</span> <span class=ow>not</span> <span class=n>email_log</span><span class=p>:</span>
</span><span id=__span-25-28><a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a>            <span class=k>continue</span>  <span class=c1># Message not found, skip</span>
</span><span id=__span-25-29><a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a>
</span><span id=__span-25-30><a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a>        <span class=k>if</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;delivered&#39;</span><span class=p>:</span>
</span><span id=__span-25-31><a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a>            <span class=n>email_log</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;delivered&#39;</span>
</span><span id=__span-25-32><a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a>            <span class=n>email_log</span><span class=o>.</span><span class=n>delivered_at</span> <span class=o>=</span> <span class=n>timestamp</span>
</span><span id=__span-25-33><a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a>
</span><span id=__span-25-34><a id=__codelineno-25-34 name=__codelineno-25-34 href=#__codelineno-25-34></a>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;bounce&#39;</span><span class=p>:</span>
</span><span id=__span-25-35><a id=__codelineno-25-35 name=__codelineno-25-35 href=#__codelineno-25-35></a>            <span class=n>email_log</span><span class=o>.</span><span class=n>status</span> <span class=o>=</span> <span class=s1>&#39;bounced&#39;</span>
</span><span id=__span-25-36><a id=__codelineno-25-36 name=__codelineno-25-36 href=#__codelineno-25-36></a>            <span class=n>email_log</span><span class=o>.</span><span class=n>error_message</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;reason&#39;</span><span class=p>,</span> <span class=s1>&#39;Unknown bounce reason&#39;</span><span class=p>)</span>
</span><span id=__span-25-37><a id=__codelineno-25-37 name=__codelineno-25-37 href=#__codelineno-25-37></a>
</span><span id=__span-25-38><a id=__codelineno-25-38 name=__codelineno-25-38 href=#__codelineno-25-38></a>            <span class=c1># Alert admin if bounce rate &gt;5%</span>
</span><span id=__span-25-39><a id=__codelineno-25-39 name=__codelineno-25-39 href=#__codelineno-25-39></a>            <span class=n>check_bounce_rate_and_alert</span><span class=p>()</span>
</span><span id=__span-25-40><a id=__codelineno-25-40 name=__codelineno-25-40 href=#__codelineno-25-40></a>
</span><span id=__span-25-41><a id=__codelineno-25-41 name=__codelineno-25-41 href=#__codelineno-25-41></a>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;open&#39;</span><span class=p>:</span>
</span><span id=__span-25-42><a id=__codelineno-25-42 name=__codelineno-25-42 href=#__codelineno-25-42></a>            <span class=n>email_log</span><span class=o>.</span><span class=n>opened_at</span> <span class=o>=</span> <span class=n>timestamp</span>
</span><span id=__span-25-43><a id=__codelineno-25-43 name=__codelineno-25-43 href=#__codelineno-25-43></a>
</span><span id=__span-25-44><a id=__codelineno-25-44 name=__codelineno-25-44 href=#__codelineno-25-44></a>        <span class=k>elif</span> <span class=n>event_type</span> <span class=o>==</span> <span class=s1>&#39;click&#39;</span><span class=p>:</span>
</span><span id=__span-25-45><a id=__codelineno-25-45 name=__codelineno-25-45 href=#__codelineno-25-45></a>            <span class=n>email_log</span><span class=o>.</span><span class=n>clicked_at</span> <span class=o>=</span> <span class=n>timestamp</span>
</span><span id=__span-25-46><a id=__codelineno-25-46 name=__codelineno-25-46 href=#__codelineno-25-46></a>
</span><span id=__span-25-47><a id=__codelineno-25-47 name=__codelineno-25-47 href=#__codelineno-25-47></a>        <span class=n>db</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span><span id=__span-25-48><a id=__codelineno-25-48 name=__codelineno-25-48 href=#__codelineno-25-48></a>
</span><span id=__span-25-49><a id=__codelineno-25-49 name=__codelineno-25-49 href=#__codelineno-25-49></a>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;status&#39;</span><span class=p>:</span> <span class=s1>&#39;success&#39;</span><span class=p>}),</span> <span class=mi>200</span>
</span></code></pre></div> <p><strong>Monitoring &amp; Alerting:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>Sentry Alerts (Configure in Sentry dashboard):
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>1. Email Delivery Failure Rate &gt;5%
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>   Condition: If (failed_count / total_count) &gt; 0.05 in 1 hour
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>   Action: Send Slack alert to #alerts channel
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>2. SendGrid API Error
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>   Condition: HTTP 500 or 503 from SendGrid
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>   Action: Page on-call engineer
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a>3. Bounce Rate Spike
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>   Condition: Bounce rate &gt;2% (normal is &lt;0.5%)
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a>   Action: Email admin (possible spam flag or invalid email list)
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a>4. Template Rendering Error
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a>   Condition: Jinja2 exception in send_email()
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>   Action: Log to Sentry, send plain text fallback
</span></code></pre></div> <p><strong>Testing Criteria:</strong> - ✅ Email logs page loads with correct data - ✅ Filters work (date range, status, event type) - ✅ Metrics calculate correctly (delivered %, bounced %) - ✅ SendGrid webhook updates <code>delivered_at</code> timestamp - ✅ Bounced email triggers admin alert - ✅ Export CSV downloads logs in correct format</p> <p><strong>Deliverable:</strong> Admin monitoring dashboard for email system health.</p> <hr> <h3 id=day-10-final-testing-documentation>Day 10: Final Testing &amp; Documentation<a class=headerlink href=#day-10-final-testing-documentation title="Permanent link">&para;</a></h3> <p><strong>Tasks:</strong> 1. End-to-end testing (all scenarios) 2. Load testing (send 100 emails simultaneously) 3. Write user documentation ("How Email Notifications Work") 4. Write admin documentation ("Email System Troubleshooting") 5. Create video tutorial (2 minutes: "Setting up Notifications")</p> <p><strong>End-to-End Test Scenarios:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>SCENARIO 1: Immediate Email on Training Complete
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>1. Configure preferences: training.complete = email enabled, immediate
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>2. Start training experiment
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>3. Wait for training to complete (~10 minutes)
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>4. ✅ Receive email within 60 seconds of completion
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>5. ✅ Email contains correct accuracy metrics
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>6. ✅ Click &quot;View Results&quot; link → Opens correct experiment page
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>7. ✅ Email logged in email_logs table
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>SCENARIO 2: No Email if Disabled
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>1. Disable email for training.complete event
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>2. Start training experiment
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>3. Training completes
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>4. ✅ No email received
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a>5. ✅ In-app toast notification still appears (other channel)
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>SCENARIO 3: Weekly Digest
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a>1. Configure preferences: training.complete = digest_weekly
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a>2. Train 3 experiments over the week
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>3. Wait until Monday 9:00 AM
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a>4. ✅ Receive single digest email summarizing 3 experiments
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a>5. ✅ Digest shows correct counts and best experiment
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a>SCENARIO 4: Training Failure Email
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a>1. Start training with invalid config (force error)
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a>2. Training fails
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a>3. ✅ Receive failure email within 60 seconds
</span><span id=__span-27-28><a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a>4. ✅ Email includes error message and suggestion
</span><span id=__span-27-29><a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a>5. ✅ Click &quot;View Error Details&quot; → Opens error page
</span><span id=__span-27-30><a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a>
</span><span id=__span-27-31><a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a>SCENARIO 5: Test Email
</span><span id=__span-27-32><a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a>1. Go to Settings → Notifications
</span><span id=__span-27-33><a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a>2. Click &quot;Send Test Email&quot;
</span><span id=__span-27-34><a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a>3. ✅ Receive test email within 60 seconds
</span><span id=__span-27-35><a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a>4. ✅ Subject has &quot;[TEST]&quot; prefix
</span><span id=__span-27-36><a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a>5. ✅ Email renders correctly on mobile device
</span><span id=__span-27-37><a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a>
</span><span id=__span-27-38><a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a>SCENARIO 6: Unsubscribe
</span><span id=__span-27-39><a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a>1. Receive training complete email
</span><span id=__span-27-40><a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a>2. Click &quot;Unsubscribe&quot; link in footer
</span><span id=__span-27-41><a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a>3. ✅ Redirects to settings page
</span><span id=__span-27-42><a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a>4. ✅ training.complete preference auto-disabled
</span><span id=__span-27-43><a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a>5. ✅ Confirmation message shown
</span><span id=__span-27-44><a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a>6. Train another experiment
</span><span id=__span-27-45><a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a>7. ✅ No email received (unsubscribed)
</span><span id=__span-27-46><a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a>
</span><span id=__span-27-47><a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a>SCENARIO 7: Email Delivery Failure
</span><span id=__span-27-48><a id=__codelineno-27-48 name=__codelineno-27-48 href=#__codelineno-27-48></a>1. Temporarily set invalid SendGrid API key
</span><span id=__span-27-49><a id=__codelineno-27-49 name=__codelineno-27-49 href=#__codelineno-27-49></a>2. Start training
</span><span id=__span-27-50><a id=__codelineno-27-50 name=__codelineno-27-50 href=#__codelineno-27-50></a>3. Training completes
</span><span id=__span-27-51><a id=__codelineno-27-51 name=__codelineno-27-51 href=#__codelineno-27-51></a>4. ✅ Email send fails (logged to Sentry)
</span><span id=__span-27-52><a id=__codelineno-27-52 name=__codelineno-27-52 href=#__codelineno-27-52></a>5. ✅ System retries 3 times
</span><span id=__span-27-53><a id=__codelineno-27-53 name=__codelineno-27-53 href=#__codelineno-27-53></a>6. ✅ Fallback: In-app notification shown
</span><span id=__span-27-54><a id=__codelineno-27-54 name=__codelineno-27-54 href=#__codelineno-27-54></a>7. ✅ Admin receives alert about email failure
</span><span id=__span-27-55><a id=__codelineno-27-55 name=__codelineno-27-55 href=#__codelineno-27-55></a>
</span><span id=__span-27-56><a id=__codelineno-27-56 name=__codelineno-27-56 href=#__codelineno-27-56></a>SCENARIO 8: Load Test
</span><span id=__span-27-57><a id=__codelineno-27-57 name=__codelineno-27-57 href=#__codelineno-27-57></a>1. Trigger 100 training completions simultaneously (scripted)
</span><span id=__span-27-58><a id=__codelineno-27-58 name=__codelineno-27-58 href=#__codelineno-27-58></a>2. ✅ All 100 emails sent (may take 1-2 minutes due to rate limit)
</span><span id=__span-27-59><a id=__codelineno-27-59 name=__codelineno-27-59 href=#__codelineno-27-59></a>3. ✅ No SendGrid rate limit errors
</span><span id=__span-27-60><a id=__codelineno-27-60 name=__codelineno-27-60 href=#__codelineno-27-60></a>4. ✅ All emails delivered successfully
</span><span id=__span-27-61><a id=__codelineno-27-61 name=__codelineno-27-61 href=#__codelineno-27-61></a>5. ✅ Email logs show 100 entries
</span></code></pre></div> <p><strong>Documentation Outline:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>User Guide: &quot;Email Notifications&quot;
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>1. Introduction
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>   - What are email notifications?
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>   - Why use them?
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>2. Configuring Preferences
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>   - Navigate to Settings → Notifications
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>   - Enable/disable per event type
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a>   - Choose frequency (immediate vs digest)
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>   - Save preferences
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>3. Event Types
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a>   - Training Complete: When model finishes training
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a>   - Training Failed: When training encounters error
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a>   - HPO Campaign Complete: When all trials finish
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a>   - [List all event types with descriptions]
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a>4. Email Digests
</span><span id=__span-28-20><a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a>   - Daily vs Weekly digests
</span><span id=__span-28-21><a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a>   - What&#39;s included in a digest
</span><span id=__span-28-22><a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a>   - How to change frequency
</span><span id=__span-28-23><a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a>
</span><span id=__span-28-24><a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a>5. Testing
</span><span id=__span-28-25><a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a>   - Send a test email
</span><span id=__span-28-26><a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a>   - Verify email arrives
</span><span id=__span-28-27><a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a>
</span><span id=__span-28-28><a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a>6. Unsubscribing
</span><span id=__span-28-29><a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a>   - Click unsubscribe link in email
</span><span id=__span-28-30><a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a>   - Or disable in settings
</span><span id=__span-28-31><a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a>
</span><span id=__span-28-32><a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a>7. Troubleshooting
</span><span id=__span-28-33><a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a>   - Email not arriving → Check spam folder
</span><span id=__span-28-34><a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a>   - Wrong email address → Update in profile
</span><span id=__span-28-35><a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a>   - Too many emails → Switch to digest mode
</span><span id=__span-28-36><a id=__codelineno-28-36 name=__codelineno-28-36 href=#__codelineno-28-36></a>
</span><span id=__span-28-37><a id=__codelineno-28-37 name=__codelineno-28-37 href=#__codelineno-28-37></a>Admin Guide: &quot;Email System Troubleshooting&quot;
</span><span id=__span-28-38><a id=__codelineno-28-38 name=__codelineno-28-38 href=#__codelineno-28-38></a>
</span><span id=__span-28-39><a id=__codelineno-28-39 name=__codelineno-28-39 href=#__codelineno-28-39></a>1. Architecture Overview
</span><span id=__span-28-40><a id=__codelineno-28-40 name=__codelineno-28-40 href=#__codelineno-28-40></a>   - SendGrid integration
</span><span id=__span-28-41><a id=__codelineno-28-41 name=__codelineno-28-41 href=#__codelineno-28-41></a>   - Notification service flow
</span><span id=__span-28-42><a id=__codelineno-28-42 name=__codelineno-28-42 href=#__codelineno-28-42></a>   - Database tables
</span><span id=__span-28-43><a id=__codelineno-28-43 name=__codelineno-28-43 href=#__codelineno-28-43></a>
</span><span id=__span-28-44><a id=__codelineno-28-44 name=__codelineno-28-44 href=#__codelineno-28-44></a>2. Monitoring
</span><span id=__span-28-45><a id=__codelineno-28-45 name=__codelineno-28-45 href=#__codelineno-28-45></a>   - Email logs page
</span><span id=__span-28-46><a id=__codelineno-28-46 name=__codelineno-28-46 href=#__codelineno-28-46></a>   - Delivery metrics
</span><span id=__span-28-47><a id=__codelineno-28-47 name=__codelineno-28-47 href=#__codelineno-28-47></a>   - SendGrid dashboard
</span><span id=__span-28-48><a id=__codelineno-28-48 name=__codelineno-28-48 href=#__codelineno-28-48></a>
</span><span id=__span-28-49><a id=__codelineno-28-49 name=__codelineno-28-49 href=#__codelineno-28-49></a>3. Common Issues
</span><span id=__span-28-50><a id=__codelineno-28-50 name=__codelineno-28-50 href=#__codelineno-28-50></a>   - High bounce rate → Clean email list
</span><span id=__span-28-51><a id=__codelineno-28-51 name=__codelineno-28-51 href=#__codelineno-28-51></a>   - Delivery failures → Check SendGrid API key
</span><span id=__span-28-52><a id=__codelineno-28-52 name=__codelineno-28-52 href=#__codelineno-28-52></a>   - Rate limit errors → Adjust local limiter
</span><span id=__span-28-53><a id=__codelineno-28-53 name=__codelineno-28-53 href=#__codelineno-28-53></a>
</span><span id=__span-28-54><a id=__codelineno-28-54 name=__codelineno-28-54 href=#__codelineno-28-54></a>4. Webhooks
</span><span id=__span-28-55><a id=__codelineno-28-55 name=__codelineno-28-55 href=#__codelineno-28-55></a>   - How SendGrid webhooks work
</span><span id=__span-28-56><a id=__codelineno-28-56 name=__codelineno-28-56 href=#__codelineno-28-56></a>   - Verifying webhook setup
</span><span id=__span-28-57><a id=__codelineno-28-57 name=__codelineno-28-57 href=#__codelineno-28-57></a>   - Testing webhook locally
</span><span id=__span-28-58><a id=__codelineno-28-58 name=__codelineno-28-58 href=#__codelineno-28-58></a>
</span><span id=__span-28-59><a id=__codelineno-28-59 name=__codelineno-28-59 href=#__codelineno-28-59></a>5. Maintenance
</span><span id=__span-28-60><a id=__codelineno-28-60 name=__codelineno-28-60 href=#__codelineno-28-60></a>   - Rotating SendGrid API keys
</span><span id=__span-28-61><a id=__codelineno-28-61 name=__codelineno-28-61 href=#__codelineno-28-61></a>   - Migrating to AWS SES
</span><span id=__span-28-62><a id=__codelineno-28-62 name=__codelineno-28-62 href=#__codelineno-28-62></a>   - Cleaning up old email logs (&gt;90 days)
</span></code></pre></div> <hr> <h2 id=37-dos-and-donts>3.7 DO'S AND DON'TS<a class=headerlink href=#37-dos-and-donts title="Permanent link">&para;</a></h2> <h3 id=dos>✅ DO's<a class=headerlink href=#dos title="Permanent link">&para;</a></h3> <ol> <li><strong>DO use transactional email service (SendGrid/SES)</strong></li> <li>Reason: Better deliverability than SMTP</li> <li> <p>Regular Gmail/Outlook SMTP gets flagged as spam</p> </li> <li> <p><strong>DO implement unsubscribe mechanism</strong></p> </li> <li>Reason: Legal requirement (CAN-SPAM Act)</li> <li> <p>Makes system professional and user-friendly</p> </li> <li> <p><strong>DO log all email sends</strong></p> </li> <li>Reason: Audit trail, debugging, metrics</li> <li> <p>Can answer "Did user receive this email?"</p> </li> <li> <p><strong>DO use retry logic with exponential backoff</strong></p> </li> <li>Reason: Transient failures (network issues)</li> <li> <p>Don't give up after first failure</p> </li> <li> <p><strong>DO separate immediate vs digest notifications</strong></p> </li> <li>Reason: Users have different preferences</li> <li> <p>Power users want immediate, managers want digests</p> </li> <li> <p><strong>DO rate limit locally</strong></p> </li> <li>Reason: Prevent hitting provider's rate limits</li> <li> <p>Cheaper to throttle ourselves than pay overage fees</p> </li> <li> <p><strong>DO provide plain text fallback</strong></p> </li> <li>Reason: Some email clients strip HTML</li> <li> <p>Accessibility (screen readers)</p> </li> <li> <p><strong>DO test templates in multiple email clients</strong></p> </li> <li>Reason: Rendering differs (Gmail ≠ Outlook)</li> <li> <p>Avoid embarrassing broken layouts</p> </li> <li> <p><strong>DO include actionable links in emails</strong></p> </li> <li>Reason: Users should be able to act immediately</li> <li> <p>"View Results" button, not just text</p> </li> <li> <p><strong>DO use email abstraction layer</strong></p> <ul> <li>Reason: Easy to switch providers later</li> <li>SendGrid → SES migration is painless</li> </ul> </li> </ol> <h3 id=donts>❌ DON'Ts<a class=headerlink href=#donts title="Permanent link">&para;</a></h3> <ol> <li><strong>DON'T send emails synchronously</strong></li> <li>Reason: Blocks request (adds 200-500ms latency)</li> <li> <p>Use Celery task queue (asynchronous)</p> </li> <li> <p><strong>DON'T store SendGrid API key in code</strong></p> </li> <li>Reason: Security risk if code is public</li> <li> <p>Use environment variables</p> </li> <li> <p><strong>DON'T email on every event</strong></p> </li> <li>Reason: Email fatigue, users unsubscribe</li> <li> <p>Default: training.started = OFF</p> </li> <li> <p><strong>DON'T forget timezone conversion</strong></p> </li> <li>Reason: User in US sees "09:00 AM" (their time)</li> <li> <p>Store timestamps in UTC, convert for display</p> </li> <li> <p><strong>DON'T use <code>&lt;img&gt;</code> for layout</strong></p> </li> <li>Reason: Email clients block images by default</li> <li> <p>Use <code>&lt;table&gt;</code> for structure, not images</p> </li> <li> <p><strong>DON'T send emails with large attachments</strong></p> </li> <li>Reason: Email size limit ~10MB, slow delivery</li> <li> <p>Use links to download from dashboard instead</p> </li> <li> <p><strong>DON'T skip input validation</strong></p> </li> <li>Reason: Invalid email addresses cause bounces</li> <li> <p>Validate format before sending</p> </li> <li> <p><strong>DON'T ignore bounce/spam reports</strong></p> </li> <li>Reason: High bounce rate → SendGrid flags your account</li> <li> <p>Monitor metrics, remove invalid emails</p> </li> <li> <p><strong>DON'T hardcode email content in code</strong></p> </li> <li>Reason: Non-technical users can't update copy</li> <li> <p>Use templates (easy to edit)</p> </li> <li> <p><strong>DON'T send marketing emails</strong></p> <ul> <li>Reason: This is transactional system (notifications)</li> <li>Marketing requires different compliance (GDPR consent)</li> </ul> </li> </ol> <hr> <h2 id=38-testing-checklist>3.8 TESTING CHECKLIST<a class=headerlink href=#38-testing-checklist title="Permanent link">&para;</a></h2> <h3 id=unit-tests-teststest_notification_servicepy>Unit Tests (<code>tests/test_notification_service.py</code>)<a class=headerlink href=#unit-tests-teststest_notification_servicepy title="Permanent link">&para;</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> <code>emit_event()</code> routes to correct channel based on preferences</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> <code>send_email()</code> calls provider API with correct payload</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> <code>get_user_preferences()</code> returns default if not set</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Retry logic retries 3 times with exponential backoff</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Rate limiter enforces 100 emails/min limit</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Email logs inserted into database after send</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Template rendering works with valid context</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Template rendering fails gracefully with invalid context</li> </ul> <h3 id=integration-tests-testsintegrationtest_email_flowpy>Integration Tests (<code>tests/integration/test_email_flow.py</code>)<a class=headerlink href=#integration-tests-testsintegrationtest_email_flowpy title="Permanent link">&para;</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Train model → Email sent within 60 seconds</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Force training error → Failure email sent</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Disabled email preference → No email sent</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Digest preference → Email queued, not sent immediately</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Test email button → Email delivered</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> SendGrid webhook → Updates delivered_at timestamp</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Unsubscribe link → Disables preference</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> 100 simultaneous emails → All delivered (load test)</li> </ul> <h3 id=manual-qa-checklist>Manual QA Checklist<a class=headerlink href=#manual-qa-checklist title="Permanent link">&para;</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Receive training complete email in Gmail (desktop)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Receive training complete email in Gmail (mobile)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Receive training complete email in Outlook</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Receive training complete email in Apple Mail</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Email renders correctly on all devices/clients</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> All links in email work (point to correct pages)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Unsubscribe link works</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Test email arrives within 60 seconds</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Failure email includes error message and suggestion</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Weekly digest includes correct summary</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Settings UI saves preferences correctly</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Email logs page shows correct data</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Metrics calculate correctly (delivered %)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Plain text version is readable</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Subject lines are descriptive and accurate</li> </ul> <hr> <h2 id=39-success-metrics>3.9 SUCCESS METRICS<a class=headerlink href=#39-success-metrics title="Permanent link">&para;</a></h2> <h3 id=quantitative>Quantitative<a class=headerlink href=#quantitative title="Permanent link">&para;</a></h3> <ul> <li>Email delivery rate: &gt;98%</li> <li>Email send latency: &lt;60 seconds from event to inbox</li> <li>Bounce rate: &lt;0.5%</li> <li>Unsubscribe rate: &lt;5% of users</li> <li>Template rendering: &lt;100ms per email</li> <li>Zero duplicate emails (idempotency)</li> </ul> <h3 id=qualitative>Qualitative<a class=headerlink href=#qualitative title="Permanent link">&para;</a></h3> <ul> <li>Users report reduced need to refresh dashboard</li> <li>Positive feedback on email design (professional)</li> <li>No spam complaints</li> <li>Users can configure preferences without help documentation</li> <li>Failure emails help users resolve issues faster</li> </ul> <hr> <h2 id=310-rollout-plan>3.10 ROLLOUT PLAN<a class=headerlink href=#310-rollout-plan title="Permanent link">&para;</a></h2> <h3 id=phase-1-internal-beta-day-1-2-of-week-2>Phase 1: Internal Beta (Day 1-2 of Week 2)<a class=headerlink href=#phase-1-internal-beta-day-1-2-of-week-2 title="Permanent link">&para;</a></h3> <ul> <li>Deploy to staging environment</li> <li>Enable for 5 internal users only</li> <li>Test all event types manually</li> <li>Collect feedback on template design</li> </ul> <h3 id=phase-2-limited-rollout-day-3-4-of-week-2>Phase 2: Limited Rollout (Day 3-4 of Week 2)<a class=headerlink href=#phase-2-limited-rollout-day-3-4-of-week-2 title="Permanent link">&para;</a></h3> <ul> <li>Deploy to production</li> <li>Enable for 20% of users (feature flag)</li> <li>Monitor email delivery metrics</li> <li>Watch for spam reports</li> </ul> <h3 id=phase-3-general-availability-day-5-of-week-2>Phase 3: General Availability (Day 5 of Week 2)<a class=headerlink href=#phase-3-general-availability-day-5-of-week-2 title="Permanent link">&para;</a></h3> <ul> <li>Enable for all users</li> <li>Announce feature in team meeting</li> <li>Send "Welcome to Email Notifications" email</li> <li>Monitor metrics for 1 week</li> </ul> <h3 id=rollback-plan>Rollback Plan<a class=headerlink href=#rollback-plan title="Permanent link">&para;</a></h3> <p>If critical issues (e.g., spam complaints, delivery failure &gt;10%): 1. Disable email channel (keep in-app notifications only) 2. Investigate issue (check SendGrid dashboard, logs) 3. Fix issue in dev environment 4. Re-enable for 10% of users (canary deployment) 5. Gradual rollout over 3 days</p> <hr> <h2 id=311-future-enhancements-post-mvp>3.11 FUTURE ENHANCEMENTS (Post-MVP)<a class=headerlink href=#311-future-enhancements-post-mvp title="Permanent link">&para;</a></h2> <h3 id=phase-2-features-if-email-notifications-are-successful>Phase 2 Features (if email notifications are successful):<a class=headerlink href=#phase-2-features-if-email-notifications-are-successful title="Permanent link">&para;</a></h3> <ol> <li><strong>SMS Notifications</strong> (via Twilio)</li> <li>Critical alerts only (training failed, system down)</li> <li>Opt-in (user provides phone number)</li> <li> <p>Cost: $0.01 per SMS</p> </li> <li> <p><strong>Email Templates Customization</strong></p> </li> <li>Allow users to choose template style (minimal, detailed, fancy)</li> <li>A/B test different designs</li> <li> <p>White-label templates (custom logo for enterprise)</p> </li> <li> <p><strong>Email Analytics Dashboard</strong></p> </li> <li>Open rate tracking (tracking pixel)</li> <li>Click-through rate (link tracking)</li> <li> <p>Best time to send (optimize for user's timezone)</p> </li> <li> <p><strong>Smart Digest Timing</strong></p> </li> <li>Learn when user typically checks dashboard</li> <li> <p>Send digest at optimal time (ML-based)</p> </li> <li> <p><strong>Email Threading</strong></p> </li> <li>Group related emails in same thread (Gmail)</li> <li> <p>"Re: Training Experiment #1234" for updates</p> </li> <li> <p><strong>Rich Notifications</strong></p> </li> <li>Inline charts in email (accuracy curve)</li> <li>Confusion matrix preview</li> <li>Requires image generation service</li> </ol> <hr> <p><strong>END OF FEATURE #3 PLAN</strong></p> <hr> <p>This completes the comprehensive planning document for <strong>Feature #3: Email Notifications</strong>. The plan includes:</p> <p>✅ <strong>Clear Objectives</strong> - What we're building and why<br> ✅ <strong>Technical Architecture</strong> - How it works (flow diagram, provider selection)<br> ✅ <strong>Database Schema</strong> - 3 new tables with indexes<br> ✅ <strong>Event Catalog</strong> - All 12+ event types and trigger points<br> ✅ <strong>Email Templates</strong> - Structure and requirements (no code, just specs)<br> ✅ <strong>Day-by-Day Implementation Plan</strong> - 10 days broken down into tasks<br> ✅ <strong>Do's and Don'ts</strong> - 20 rules for the team to follow<br> ✅ <strong>Testing Checklist</strong> - Unit, integration, manual QA<br> ✅ <strong>Success Metrics</strong> - How to measure if feature is working<br> ✅ <strong>Rollout Plan</strong> - Phased deployment with rollback strategy<br> ✅ <strong>Future Enhancements</strong> - What comes next (if successful) </p> <p><strong>Ready for your development team to execute with minimal supervision.</strong></p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024-2026 Syed Abbas Ahmad </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/abbas-ahmad-cowlar/LSTM_PFD target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "content.tabs.link", "content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../../javascripts/mathjax.js></script> <script src=https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>